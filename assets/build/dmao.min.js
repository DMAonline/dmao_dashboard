function reverseChronoChartData(a){for(var b=[],c=a.length,d=0;d<a.length;++d)--c,b[d]=[a[c].month,a[c].value];return b}function toDataTablesFormat(a){return hash={},hash.data=a,hash}var app=angular.module("dmaoApp",["ngRoute"]);app.factory("api",function(){return ApiService}),app.factory("config",function(){return App}),app.config(["$routeProvider",function(a){a.when("/",{templateUrl:"app/statistics/statistic-compilation.html"}).when("/datasets",{templateUrl:"app/tables/datasets-table.html"}).when("/datasetsRCUK",{templateUrl:"app/tables/datasets-rcuk-table.html"}).when("/dmp",{templateUrl:"app/tables/dmp-table.html"}).when("/nodmp",{templateUrl:"app/tables/no-dmp-table.html"}).when("/dmps",{templateUrl:"app/tables/dmp-status-table.html"}).when("/storage",{templateUrl:"app/tables/storage-table.html"}).when("/compliance",{templateUrl:"app/tables/rcuk-access-compliance-table.html"}).otherwise({templateUrl:"app/messages/error.html"})}]),app.controller("dataAccessChartCtrl",["$scope","$rootScope","$http","api","config",function(a,b,c,d,e){function f(a){var b={date:"project_start",sd:a.startDate,ed:a.endDate,faculty:a.faculty,summary_by_date:!0};d.uri.datasetAccess(b).then(function(a){a=d.filter.datasetAccess(a,"data_download"),DataAccessLineChart(a,{width:700,height:300})})}var g={startDate:e.startDateDefault,endDate:e.endDateDefault,faculty:e.facultyDefault,summary_by_date:!0};f(g),a.filterEventListener=b.$on("FilterEvent",function(a,b){f(b)}),a.$on("$destroy",function(){a.filterEventListener()})}]);var DataAccessLineChart=function(a,b){var c=!0;if(c){var d={top:20,right:20,bottom:30,left:100},e=b.width-d.left-d.right,f=b.height-d.top-d.bottom,g=d3.time.format("%Y-%m-%d").parse,h=d3.time.scale().range([0,e]),i=d3.scale.linear().range([f,0]),j=d3.svg.axis().scale(h).orient("bottom"),k=d3.svg.axis().scale(i).orient("left"),l=d3.svg.line().x(function(a){return h(a.access_date)}).y(function(a){return i(a.counter)});$("#dataAccessChart").empty();var m=d3.select("#dataAccessChart").append("svg").attr("width",b.width+d.left+d.right).attr("height",b.height+d.top+d.bottom).append("g").attr("transform","translate("+d.left+","+d.top+")");a.forEach(function(a){a.access_date=g(a.access_date),a.counter=+a.sum}),h.domain(d3.extent(a,function(a){return a.access_date})),i.domain(d3.extent(a,function(a){return a.counter})),m.append("g").attr("class","x axis").attr("transform","translate(0,"+f+")").call(j),m.append("g").attr("class","y axis").call(k).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text("Downloads"),m.append("path").datum(a).attr("class","line").attr("d",l)}};app.controller("metadataAccessChartCtrl",["$scope","$rootScope","$http","api","config",function(a,b,c,d,e){function f(a){var b={date:"project_start",sd:a.startDate,ed:a.endDate,faculty:a.faculty,summary_by_date:!0};d.uri.datasetAccess(b).then(function(a){a=d.filter.datasetAccess(a,"metadata"),MetadataAccessLineChart(a,{width:700,height:300})})}var g={startDate:e.startDateDefault,endDate:e.endDateDefault,faculty:e.facultyDefault,summary_by_date:!0};f(g),a.filterEventListener=b.$on("FilterEvent",function(a,b){f(b)}),a.$on("$destroy",function(){a.filterEventListener()})}]);var MetadataAccessLineChart=function(a,b){var c=!0;if(c){var d={top:20,right:20,bottom:30,left:100},e=b.width-d.left-d.right,f=b.height-d.top-d.bottom,g=d3.time.format("%Y-%m-%d").parse,h=d3.time.scale().range([0,e]),i=d3.scale.linear().range([f,0]),j=d3.svg.axis().scale(h).orient("bottom"),k=d3.svg.axis().scale(i).orient("left"),l=d3.svg.line().x(function(a){return h(a.access_date)}).y(function(a){return i(a.counter)});$("#metadataAccessChart").empty();var m=d3.select("#metadataAccessChart").append("svg").attr("width",b.width+d.left+d.right).attr("height",b.height+d.top+d.bottom).append("g").attr("transform","translate("+d.left+","+d.top+")");a.forEach(function(a){a.access_date=g(a.access_date),a.counter=+a.sum}),h.domain(d3.extent(a,function(a){return a.access_date})),i.domain(d3.extent(a,function(a){return a.counter})),m.append("g").attr("class","x axis").attr("transform","translate(0,"+f+")").call(j),m.append("g").attr("class","y axis").call(k).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text("Accesses"),m.append("path").datum(a).attr("class","line").attr("d",l)}},DataAccessChart={init:function(a){$.ajax({url:ApiService.uri.datasetAccess(a),success:function(a){var b=ApiService.filter.datasetAccess(a,"data_download"),c=12,d=ApiService.filter.dataLastNMonths(b,c),e=reverseChronoChartData(d);if(0!=$("#data_access").size()){$("#data_access_loading").hide(),$("#data_access_content").show();var f=($.plot($("#data_access"),[{data:e,lines:{fill:.2,lineWidth:0},color:["#BAD9F5"]},{data:e,points:{show:!0,fill:!0,radius:4,fillColor:"#9ACAE6",lineWidth:2},color:"#9ACAE6",shadowSize:1},{data:e,lines:{show:!0,fill:!1,lineWidth:3},color:"#9ACAE6",shadowSize:0}],{xaxis:{tickLength:0,tickDecimals:0,mode:"categories",min:0,font:{lineHeight:14,style:"normal",variant:"small-caps",color:"#6F7B8A"}},yaxis:{ticks:5,tickDecimals:0,tickColor:"#eee",font:{lineHeight:14,style:"normal",variant:"small-caps",color:"#6F7B8A"}},grid:{hoverable:!0,clickable:!0,tickColor:"#eee",borderColor:"#eee",borderWidth:1}}),null);$("#data_access").bind("plothover",function(a,b,c){if($("#x").text(b.x.toFixed(2)),$("#y").text(b.y.toFixed(2)),c){if(f!=c.dataIndex){f=c.dataIndex,$("#tooltip").remove();c.datapoint[0].toFixed(2),c.datapoint[1].toFixed(2);showChartTooltip(c.pageX,c.pageY,c.datapoint[0],c.datapoint[1]+" downloads")}}else $("#tooltip").remove(),f=null})}}})}},MetadataAccessChart={init:function(a){$.ajax({url:ApiService.uri.datasetAccess(a),success:function(a){var b=ApiService.filter.datasetAccess(a,"metadata"),c=12,d=ApiService.filter.dataLastNMonths(b,c),e=reverseChronoChartData(d);if(0!=$("#metadata_access").size()){$("#metadata_access_loading").hide(),$("#metadata_access_content").show();var f=($.plot($("#metadata_access"),[{data:e,lines:{fill:.2,lineWidth:0},color:["#f89f9f"]},{data:e,points:{show:!0,fill:!0,radius:4,fillColor:"#f89f9f",lineWidth:2},color:"#f89f9f",shadowSize:1},{data:e,lines:{show:!0,fill:!1,lineWidth:3},color:"#f89f9f",shadowSize:0}],{xaxis:{tickLength:0,tickDecimals:0,mode:"categories",min:0,font:{lineHeight:14,style:"normal",variant:"small-caps",color:"#6F7B8A"}},yaxis:{ticks:5,tickDecimals:0,tickColor:"#eee",font:{lineHeight:14,style:"normal",variant:"small-caps",color:"#6F7B8A"}},grid:{hoverable:!0,clickable:!0,tickColor:"#eee",borderColor:"#eee",borderWidth:1}}),null);$("#metadata_access").bind("plothover",function(a,b,c){if($("#x").text(b.x.toFixed(2)),$("#y").text(b.y.toFixed(2)),c){if(f!=c.dataIndex){f=c.dataIndex,$("#tooltip").remove();c.datapoint[0].toFixed(2),c.datapoint[1].toFixed(2);showChartTooltip(c.pageX,c.pageY,c.datapoint[0],c.datapoint[1]+" downloads")}}else $("#tooltip").remove(),f=null})}}})}};app.controller("filterCtrl",["$scope","$rootScope","$interval","config",function(a,b,c,d){function e(c){b.$broadcast("FilterEvent",{msg:c,startDate:a.startDate,endDate:a.endDate,faculty:a.faculty})}function f(){e("Timed update")}a.startDate=d.startDateDefault,a.endDate=d.endDateDefault,a.faculty=d.facultyDefault,a.facultyName=d.facultyMap[d.facultyDefault];var g=d.updateDelay;c(f,g),a.$watch(function(){return a.startDate},function(b,c){a.startDate=b}),a.$watch(function(){return a.endDate},function(b,c){a.endDate=b}),a.$watch(function(){return a.faculty},function(b,c){a.faculty=b,a.facultyName=d.facultyMap[b]}),a.$watch(function(){return{startDate:a.startDate,endDate:a.endDate,faculty:a.faculty}},function(a,b){var c=!1;a.startDate!==b.startDate&&(c=!0),a.endDate!==b.endDate&&(c=!0),a.faculty!==b.faculty&&(c=!0),c&&e("Filter change")},!0)}]);var DMAOFilters=function(){var a={},b=function(b){a=b},c=function(){$("#reportrange span").html(moment(a.startDate,"YYYYMMDD").format("MMMM D, YYYY")+" - "+moment(a.endDate,"YYYYMMDD").format("MMMM D, YYYY")),$("#reportrange").daterangepicker({format:"DD/MM/YYYY",startDate:moment(a.startDateDefault,"YYYYMMDD").format("DD/MM/YYYY"),endDate:moment(a.endDateDefault,"YYYYMMDD").format("DD/MM/YYYY"),minDate:"01/01/2000",maxDate:"31/12/9999",dateLimit:{days:1e5},showDropdowns:!0,showWeekNumbers:!0,timePicker:!1,timePickerIncrement:1,timePicker12Hour:!0,ranges:{Today:[moment(),moment()],Yesterday:[moment().subtract(1,"days"),moment().subtract(1,"days")],"Last 7 Days":[moment().subtract(6,"days"),moment()],"Last 30 Days":[moment().subtract(29,"days"),moment()],"This Month":[moment().startOf("month"),moment().endOf("month")],"Last Month":[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")]},opens:"left",drops:"down",buttonClasses:["btn","btn-sm"],applyClass:"btn-primary",cancelClass:"btn-default",separator:" to ",locale:{applyLabel:"Submit",cancelLabel:"Cancel",fromLabel:"From",toLabel:"To",customRangeLabel:"Custom",daysOfWeek:["Su","Mo","Tu","We","Th","Fr","Sa"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],firstDay:1}},function(b,c,d){$("#reportrange span").html(b.format("MMMM D, YYYY")+" - "+c.format("MMMM D, YYYY"));var e=b.format("YYYYMMDD"),f=c.format("YYYYMMDD");a.startDate=e,a.endDate=f;var g=angular.element($("#filterController")).scope();g.$apply(function(){g.startDate=e,g.endDate=f})}),$(".applyBtn").click(function(){var b=$('input[name="daterangepicker_start"]').val(),c=moment(b,"DD/MM/YYYY").format("YYYYMMDD"),d=$('input[name="daterangepicker_end"]').val(),e=moment(d,"DD/MM/YYYY").format("YYYYMMDD");a.startDate=c,a.endDate=e;var f=angular.element($("#filterController")).scope();f.$apply(function(){f.startDate=c,f.endDate=e})})},d=function(b){a.faculty=b;var c=angular.element($("#filterController")).scope();c.$apply(function(){c.faculty=b})},e=function(){a.faculty=a.facultyDefault,a.startDate=a.startDateDefault,a.endDate=a.endDateDefault,$("#reportrange").data("daterangepicker").setStartDate(moment(a.startDateDefault,"YYYYMMDD").format("DD/MM/YYYY")),$("#reportrange").data("daterangepicker").setEndDate(moment(a.endDateDefault,"YYYYMMDD").format("DD/MM/YYYY")),$("#reportrange span").html(moment(a.startDateDefault,"YYYYMMDD").format("MMMM D, YYYY")+" - "+moment(a.endDateDefault,"YYYYMMDD").format("MMMM D, YYYY"));var b=angular.element($("#filterController")).scope();b.$apply(function(){b.faculty=a.faculty,b.startDate=a.startDateDefault,b.endDate=a.endDateDefault})};return{init:b,initUserSelections:e,DateRangePicker:c,setFaculty:d}}(),App={institutionId:"lancaster",startDateDefault:"20000101",endDateDefault:"20350101",startDate:"20000101",endDate:"20350101",faculty:"",facultyDefault:"",facultyMap:{"":"All faculties",1:"Faculty of Arts and Social Sciences",2:"Faculty of Science and Technology",3:"Faculty of Health and Medicine",4:"Lancaster University Management School"},updateDelay:3e4},ApiService={version:"v0.2",prefix:function(){var a=URI({protocol:"http",hostname:"lib-ldiv.lancs.ac.uk",port:"8080",path:"dmaonline"});return a+="/"+this.version,a.toString()},uri:{addParams:function(a,b){for(key in b)a.addSearch(key,b[key]);return a},datasets:function(a){var b=URI(ApiService.prefix()+"/datasets/"+App.institutionId);return a&&(b=this.addParams(b,a)),$.getJSON(b)},dmps:function(a){var b=URI(ApiService.prefix()+"/project_dmps/"+App.institutionId);return a&&(b=this.addParams(b,a)),$.getJSON(b)},dmpStatus:function(a){var b=URI(ApiService.prefix()+"/dmp_status/"+App.institutionId);return a&&(b=this.addParams(b,a)),$.getJSON(b)},storage:function(a){var b=URI(ApiService.prefix()+"/storage/"+App.institutionId);return a&&(b=this.addParams(b,a)),$.getJSON(b)},rcukAccessCompliance:function(a){var b=URI(ApiService.prefix()+"/rcuk_as/"+App.institutionId);return a&&(b=this.addParams(b,a)),$.getJSON(b)},datasetAccess:function(a){var b=URI(ApiService.prefix()+"/dataset_accesses/"+App.institutionId);return a&&(b=this.addParams(b,a)),$.getJSON(b)},datasetAccessByDateRange:function(a){var b=this.datasetAccess(a);return $.getJSON(b)}},filter:{datasetAccess:function(a,b){for(var c=[],d=0;d<a.length;++d)a[d].access_type===b&&c.push(a[d]);return c},dataLastNMonths:function(a,b){for(var c=[],d=0;b>d;++d){var e=moment().subtract(d,"months").startOf("month").format("YYYY-MM-DD"),f=moment().subtract(d,"months").endOf("month").format("YYYY-MM-DD");c.push({startDate:e,endDate:f,month:moment(e).format("MMM"),value:0})}for(var d=0;d<a.length;++d)for(var g=0;b>g;++g)a[d].access_date>=c[g].startDate&&a[d].access_date<=c[g].endDate&&(c[g].value+=a[d].counter);return c},dataAggregateDateCounts:function(a){for(var b={},c=0;c<a.length;++c){var d=a[c].access_date.replace(/-/g,"");if(b[d])b[d].counter+=a[c].counter;else{var e={access_date:a[c].access_date,counter:a[c].counter};b[d]=e}}var f=[];return $.each(b,function(a,c){f.push(b[a])}),f}},template:{dr:"/dr/{institutionId}/{startDate}/{endDate}/{dateFilter}"}};app.controller("datasetsRCUKCtrl",["$scope","$rootScope","$http","api","config",function(a,b,c,d,e){function f(b){var c={date:"project_start",sd:b.startDate,ed:b.endDate,faculty:b.faculty,filter:"rcuk",count:!0};d.uri.datasets(c).then(function(b){a.$apply(function(){var c=b[0].num_datasets;c!==a.value&&(a.value=c)})})}a.value=0,f({startDate:e.startDateDefault,endDate:e.endDateDefault,faculty:e.facultyDefault}),a.filterEventListener=b.$on("FilterEvent",function(a,b){f(b)}),a.$on("$destroy",function(){a.filterEventListener()})}]),app.controller("datasetsCtrl",["$scope","$rootScope","$http","api","config",function(a,b,c,d,e){function f(b){var c={date:"project_start",sd:b.startDate,ed:b.endDate,faculty:b.faculty,count:!0};d.uri.datasets(c).then(function(b){a.$apply(function(){var c=b[0].num_datasets;c!==a.value&&(a.value=c)})})}a.value=0,f({startDate:e.startDateDefault,endDate:e.endDateDefault,faculty:e.facultyDefault}),a.filterEventListener=b.$on("FilterEvent",function(a,b){f(b)}),a.$on("$destroy",function(){a.filterEventListener()})}]),app.controller("dmpsCreatedCtrl",["$scope","$rootScope","$http","api","config",function(a,b,c,d,e){function f(b){var c={date:"project_start",sd:b.startDate,ed:b.endDate,faculty:b.faculty,has_dmp:!0,count:!0};d.uri.dmps(c).then(function(b){a.$apply(function(){var c=b[0].num_project_dmps;c!==a.value&&(a.value=c)})})}a.value=0,f({startDate:e.startDateDefault,endDate:e.endDateDefault,faculty:e.facultyDefault}),a.filterEventListener=b.$on("FilterEvent",function(a,b){f(b)}),a.$on("$destroy",function(){a.filterEventListener()})}]),app.controller("dmpStatusCtrl",["$scope","$rootScope","$http","api","config",function(a,b,c,d,e){function f(b){var c={date:"project_start",sd:b.startDate,ed:b.endDate,faculty:b.faculty,count:!0};d.uri.dmpStatus(c).then(function(b){a.$apply(function(){var c=b[0].num_dmp_status;c!==a.value&&(a.value=c)})})}a.value=0,f({startDate:e.startDateDefault,endDate:e.endDateDefault,faculty:e.facultyDefault}),a.filterEventListener=b.$on("FilterEvent",function(a,b){f(b)}),a.$on("$destroy",function(){a.filterEventListener()})}]),app.controller("noDmpProjectsCtrl",["$scope","$rootScope","$http","api","config",function(a,b,c,d,e){function f(b){var c={date:"project_start",sd:b.startDate,ed:b.endDate,faculty:b.faculty,has_dmp:!1,count:!0};d.uri.dmps(c).then(function(b){a.$apply(function(){var c=b[0].num_project_dmps;c!==a.value&&(a.value=c)})})}f({startDate:e.startDateDefault,endDate:e.endDateDefault,faculty:e.facultyDefault}),a.filterEventListener=b.$on("FilterEvent",function(a,b){f(b)}),a.$on("$destroy",function(){a.filterEventListener()})}]),app.controller("rcukAccessComplianceCtrl",["$scope","$rootScope","$http","api","config",function(a,b,c,d,e){function f(b){var c={date:"project_start",sd:b.startDate,ed:b.endDate,faculty:b.faculty};d.uri.rcukAccessCompliance(c).then(function(b){a.$apply(function(){var c=0;for(i=0;i<b.length;++i)"exists with persistent link"===b[i].data_access_statement&&++c;var d=0;c&&c!==a.value&&(d=c/b.length*100,a.value=Math.round(d))})})}a.value=0,f({startDate:e.startDateDefault,endDate:e.endDateDefault,faculty:e.facultyDefault}),a.filterEventListener=b.$on("FilterEvent",function(a,b){f(b)}),a.$on("$destroy",function(){a.filterEventListener()})}]),app.directive("statistic",function(){return{restrict:"E",templateUrl:"app/statistics/statistic-directive.html",replace:"true",scope:{value:"@",description:"@",icon:"@",colour:"@",link:"@",units:"@",currency:"@"}}}),app.controller("storageCostCtrl",["$scope","$rootScope","$http","api","config",function(a,b,c,d,e){function f(b){var c={date:"project_start",sd:b.startDate,ed:b.endDate,faculty:b.faculty};d.uri.storage(c).then(function(b){a.$apply(function(){var c=0,d=-1;for(i=0;i<b.length;++i)b[i].project_id!=d&&(c+=b[i].expected_storage_cost),d=b[i].project_id;var e=Math.round(c);e!==a.value&&(a.value=e)})})}a.value=0,f({startDate:e.startDateDefault,endDate:e.endDateDefault,faculty:e.facultyDefault}),a.filterEventListener=b.$on("FilterEvent",function(a,b){f(b)}),a.$on("$destroy",function(){a.filterEventListener()})}]),app.controller("storageUnitCtrl",["$scope","$rootScope","$http","api","config",function(a,b,c,d,e){function f(b){var c={date:"project_start",sd:b.startDate,ed:b.endDate,faculty:b.faculty};d.uri.storage(c).then(function(b){a.$apply(function(){var c=0,d=-1;for(i=0;i<b.length;++i)b[i].project_id!=d&&(c+=b[i].expected_storage),d=b[i].project_id;var e=Math.round(.001024*c);e!==a.value&&(a.value=e)})})}a.value=0,f({startDate:e.startDateDefault,endDate:e.endDateDefault,faculty:e.facultyDefault}),a.filterEventListener=b.$on("FilterEvent",function(a,b){f(b)}),a.$on("$destroy",function(){a.filterEventListener()})}]),app.controller("datasetsRCUKTableCtrl",["$scope","$rootScope","$http","api","config",function(a,b,c,d,e){function f(a){var b={date:"project_start",sd:a.startDate,ed:a.endDate,faculty:a.faculty,filter:"rcuk"};d.uri.datasets(b).then(function(a){DatasetsRCUKTable.init(a)})}var g={startDate:e.startDateDefault,endDate:e.endDateDefault,faculty:e.facultyDefault};f(g),a.filterEventListener=b.$on("FilterEvent",function(a,b){f(b)}),a.$on("$destroy",function(){a.filterEventListener()})}]);var DatasetsRCUKTable=function(){function a(a){var b=toDataTablesFormat(a),c=$("#rcukDatasetsTable").dataTable();c.fnDestroy(),d=$("#rcukDatasetsTable").DataTable({lengthMenu:[25,50,75,100],data:b.data,dom:"ClfrtipR",columns:[{data:null,className:"details-control",orderable:!1,defaultContent:""},{data:"dataset_name"},{data:"funder_name"},{data:"dataset_pid"},{data:"lead_faculty_abbrev"},{data:"lead_dept_name"},{data:"project_name"},{data:"project_start"},{data:"project_end"}]})}function b(){$("#rcukDatasetsTable tbody").on("click","td.details-control",function(){var a=$(this).closest("tr"),b=d.row(a);b.child.isShown()?(b.child.hide(),a.removeClass("shown")):(b.child(c(b.data())).show(),a.addClass("shown"))})}function c(a){return'<table cellpadding="5" cellspacing="0" border="0" style="padding-left:50px;"><tr><td>Project id:</td><td>'+a.project_id+"</td></tr><tr><td>Project name:</td><td>"+a.project_name+"</td></tr><tr><td>Project start date:</td><td>"+a.project_start+"</td></tr><tr><td>Project end date:</td><td>"+a.project_end+"</td></tr><tr><td>Funder id:</td><td>"+a.funder_id+"</td></tr><tr><td>Funder name:</td><td>"+a.funder_name+"</td></tr><tr><td>Dataset id:</td><td>"+a.dataset_id+"</td></tr><tr><td>Dataset pid:</td><td>"+a.dataset_pid+"</td></tr><tr><td>Dataset link:</td><td>"+a.dataset_link+"</td></tr><tr><td>Dataset size:</td><td>"+a.dataset_size+"</td></tr><tr><td>Dataset name:</td><td>"+a.dataset_name+"</td></tr><tr><td>Dataset notes:</td><td>"+a.dataset_notes+"</td></tr><tr><td>Storage location:</td><td>"+a.storage_location+"</td></tr><tr><td>Lead faculty id:</td><td>"+a.lead_faculty_id+"</td></tr><tr><td>Lead faculty abbreviation:</td><td>"+a.lead_faculty_abbrev+"</td></tr><tr><td>Lead faculty name:</td><td>"+a.lead_faculty_name+"</td></tr><tr><td>Lead department id:</td><td>"+a.lead_department_id+"</td></tr><tr><td>Lead department abbrev:</td><td>"+a.lead_dept_abbrev+"</td></tr><tr><td>Lead department name:</td><td>"+a.lead_dept_name+"</td></tr></table>"}var d,e=function(c){a(c),b()};return{init:e}}();app.controller("datasetsTableCtrl",["$scope","$rootScope","$http","api","config",function(a,b,c,d,e){function f(a){var b={date:"project_start",sd:a.startDate,ed:a.endDate,faculty:a.faculty};d.uri.datasets(b).then(function(a){DatasetsTable.init(a)})}var g={startDate:e.startDateDefault,endDate:e.endDateDefault,faculty:e.facultyDefault};f(g),a.filterEventListener=b.$on("FilterEvent",function(a,b){f(b)}),a.$on("$destroy",function(){a.filterEventListener()})}]);var DatasetsTable=function(){function a(a){var b=toDataTablesFormat(a),c=$("#datasetsTable").dataTable();c.fnDestroy(),d=$("#datasetsTable").DataTable({lengthMenu:[25,50,75,100],data:b.data,dom:"ClfrtipR",columns:[{data:null,className:"details-control",orderable:!1,defaultContent:""},{data:"dataset_name"},{data:"funder_name"},{data:"dataset_pid"},{data:"lead_faculty_abbrev"},{data:"lead_dept_name"},{data:"project_name"},{data:"project_start"},{data:"project_end"}]})}function b(){$("#datasetsTable tbody").on("click","td.details-control",function(){var a=$(this).closest("tr"),b=d.row(a);b.child.isShown()?(b.child.hide(),a.removeClass("shown")):(b.child(c(b.data())).show(),a.addClass("shown"))})}function c(a){return'<table cellpadding="5" cellspacing="0" border="0" style="padding-left:50px;"><tr><td>Project id:</td><td>'+a.project_id+"</td></tr><tr><td>Project name:</td><td>"+a.project_name+"</td></tr><tr><td>Project start date:</td><td>"+a.project_start+"</td></tr><tr><td>Project end date:</td><td>"+a.project_end+"</td></tr><tr><td>Funder id:</td><td>"+a.funder_id+"</td></tr><tr><td>Funder name:</td><td>"+a.funder_name+"</td></tr><tr><td>Dataset id:</td><td>"+a.dataset_id+"</td></tr><tr><td>Dataset pid:</td><td>"+a.dataset_pid+"</td></tr><tr><td>Dataset link:</td><td>"+a.dataset_link+"</td></tr><tr><td>Dataset size:</td><td>"+a.dataset_size+"</td></tr><tr><td>Dataset name:</td><td>"+a.dataset_name+"</td></tr><tr><td>Dataset notes:</td><td>"+a.dataset_notes+"</td></tr><tr><td>Storage location:</td><td>"+a.storage_location+"</td></tr><tr><td>Lead faculty id:</td><td>"+a.lead_faculty_id+"</td></tr><tr><td>Lead faculty abbreviation:</td><td>"+a.lead_faculty_abbrev+"</td></tr><tr><td>Lead faculty name:</td><td>"+a.lead_faculty_name+"</td></tr><tr><td>Lead department id:</td><td>"+a.lead_department_id+"</td></tr><tr><td>Lead department abbrev:</td><td>"+a.lead_dept_abbrev+"</td></tr><tr><td>Lead department name:</td><td>"+a.lead_dept_name+"</td></tr></table>"}var d,e=function(c){a(c),b()};return{init:e}}();app.controller("dmpStatusTableCtrl",["$scope","$rootScope","$http","api","config",function(a,b,c,d,e){function f(a){var b={date:"project_start",sd:a.startDate,ed:a.endDate,faculty:a.faculty,has_dmp:!0};d.uri.dmpStatus(b).then(function(a){DmpStatusTable.init(a)})}var g={startDate:e.startDateDefault,endDate:e.endDateDefault,faculty:e.facultyDefault};f(g),a.filterEventListener=b.$on("FilterEvent",function(a,b){f(b)}),a.$on("$destroy",function(){a.filterEventListener()})}]);var DmpStatusTable=function(){function a(a){var b=toDataTablesFormat(a),c=$("#dmpStatusTable").dataTable();c.fnDestroy(),d=$("#dmpStatusTable").DataTable({lengthMenu:[25,50,75,100],data:b.data,dom:"ClfrtipR",columns:[{data:null,className:"details-control",orderable:!1,defaultContent:""},{data:"project_name"},{data:"funder_id"},{data:"dmp_state"},{data:"dmp_status"},{data:"project_start"},{data:"project_end"}]})}function b(){$("#dmpStatusTable tbody").on("click","td.details-control",function(){var a=$(this).closest("tr"),b=d.row(a);b.child.isShown()?(b.child.hide(),a.removeClass("shown")):(b.child(c(b.data())).show(),a.addClass("shown"))})}function c(a){return'<table cellpadding="5" cellspacing="0" border="0" style="padding-left:50px;"><tr><td>Project id:</td><td>'+a.project_id+"</td></tr><tr><td>Project name:</td><td>"+a.project_name+"</td></tr><tr><td>Project start date:</td><td>"+a.project_start+"</td></tr><tr><td>Project end date:</td><td>"+a.project_end+"</td></tr><tr><td>Funder project code:</td><td>"+a.funder_project_code+"</td></tr><tr><td>Is awarded:</td><td>"+a.is_awarded+"</td></tr><tr><td>Institution id:</td><td>"+a.inst_id+"</td></tr><tr><td>Institution project code:</td><td>"+a.institution_project_code+"</td></tr><tr><td>Data management plan id:</td><td>"+a.dmp_id+"</td></tr><tr><td>Has data management plan been reviewed:</td><td>"+a.has_dmp_been_reviewed+"</td></tr></tr><td>Expected storage:</td><td>"+a.expected_storage+"</td></tr><tr><td>Lead faculty id:</td><td>"+a.lead_faculty_id+"</td></tr><tr><td>Lead department id:</td><td>"+a.lead_department_id+"</td></tr><tr><td>Data management plan source system id:</td><td>"+a.dmp_source_system_id+"</td></tr><tr><td>Data management plan state:</td><td>"+a.dmp_state+"</td></tr><tr><td>Data management plan status:</td><td>"+a.dmp_status+"</td></tr></table>"}var d,e=function(c){a(c),b()};return{init:e}}();app.controller("dmpTableCtrl",["$scope","$rootScope","$http","api","config",function(a,b,c,d,e){function f(a){var b={date:"project_start",sd:a.startDate,ed:a.endDate,faculty:a.faculty,has_dmp:!0};d.uri.dmps(b).then(function(a){DmpTable.init(a)})}var g={startDate:e.startDateDefault,endDate:e.endDateDefault,faculty:e.facultyDefault};f(g),a.filterEventListener=b.$on("FilterEvent",function(a,b){f(b)}),a.$on("$destroy",function(){a.filterEventListener()})}]);var DmpTable=function(){function a(a){var b=toDataTablesFormat(a),c=$("#dmpTable").dataTable();c.fnDestroy(),d=$("#dmpTable").DataTable({lengthMenu:[25,50,75,100],data:b.data,dom:"ClfrtipR",columns:[{data:null,className:"details-control",orderable:!1,defaultContent:""},{data:"project_name"},{data:"lead_faculty_abbrev"},{data:"lead_dept_name"},{data:"dmp_id"},{data:"has_dmp_been_reviewed"},{data:"project_start"},{data:"project_end"}]})}function b(){$("#dmpTable tbody").on("click","td.details-control",function(){var a=$(this).closest("tr"),b=d.row(a);b.child.isShown()?(b.child.hide(),a.removeClass("shown")):(b.child(c(b.data())).show(),a.addClass("shown"))})}function c(a){return'<table cellpadding="5" cellspacing="0" border="0" style="padding-left:50px;"><tr><td>Project id:</td><td>'+a.project_id+"</td></tr><tr><td>Project name:</td><td>"+a.project_name+"</td></tr><tr><td>Project start date:</td><td>"+a.project_start+"</td></tr><tr><td>Project end date:</td><td>"+a.project_end+"</td></tr><tr><td>Funder project code:</td><td>"+a.funder_project_code+"</td></tr><tr><td>Is awarded:</td><td>"+a.is_awarded+"</td></tr><tr><td>Institution id:</td><td>"+a.inst_id+"</td></tr><tr><td>Institution project code:</td><td>"+a.institution_project_code+"</td></tr><tr><td>Data management plan id:</td><td>"+a.dmp_id+"</td></tr><tr><td>Has data management plan:</td><td>"+a.has_dmp+"</td></tr><tr><td>Has data management plan been reviewed:</td><td>"+a.has_dmp_been_reviewed+"</td></tr></tr><td>Expected storage:</td><td>"+a.expected_storage+"</td></tr><tr><td>Lead faculty id:</td><td>"+a.lead_faculty_id+"</td></tr><tr><td>Lead faculty abbreviation:</td><td>"+a.lead_faculty_abbrev+"</td></tr><tr><td>Lead faculty name:</td><td>"+a.lead_faculty_name+"</td></tr><tr><td>Lead department id:</td><td>"+a.lead_department_id+"</td></tr><tr><td>Lead department abbrev:</td><td>"+a.lead_dept_abbrev+"</td></tr><tr><td>Lead department name:</td><td>"+a.lead_dept_name+"</td></tr></table>"}var d,e=function(c){a(c),b()};return{init:e}}();app.controller("noDmpTableCtrl",["$scope","$rootScope","$http","api","config",function(a,b,c,d,e){function f(a){var b={date:"project_start",sd:a.startDate,ed:a.endDate,faculty:a.faculty,has_dmp:!1};d.uri.dmps(b).then(function(a){NoDmpTable.init(a)})}var g={startDate:e.startDateDefault,endDate:e.endDateDefault,faculty:e.facultyDefault};f(g),a.filterEventListener=b.$on("FilterEvent",function(a,b){f(b)}),a.$on("$destroy",function(){a.filterEventListener()})}]);var NoDmpTable=function(){function a(a){var b=toDataTablesFormat(a),c=$("#noDmpTable").dataTable();c.fnDestroy(),d=$("#noDmpTable").DataTable({lengthMenu:[25,50,75,100],data:b.data,dom:"ClfrtipR",columns:[{data:null,className:"details-control",orderable:!1,defaultContent:""},{data:"project_name"},{data:"lead_faculty_abbrev"},{data:"lead_dept_name"}]})}function b(){$("#noDmpTable tbody").on("click","td.details-control",function(){var a=$(this).closest("tr"),b=d.row(a);b.child.isShown()?(b.child.hide(),a.removeClass("shown")):(b.child(c(b.data())).show(),a.addClass("shown"))})}function c(a){return'<table cellpadding="5" cellspacing="0" border="0" style="padding-left:50px;"><tr><td>Project id:</td><td>'+a.project_id+"</td></tr><tr><td>Project name:</td><td>"+a.project_name+"</td></tr><tr><td>Project start date:</td><td>"+a.project_start+"</td></tr><tr><td>Project end date:</td><td>"+a.project_end+"</td></tr><tr><td>Funder project code:</td><td>"+a.funder_project_code+"</td></tr><tr><td>Is awarded:</td><td>"+a.is_awarded+"</td></tr><tr><td>Institution id:</td><td>"+a.inst_id+"</td></tr><tr><td>Institution project code:</td><td>"+a.institution_project_code+"</td></tr><tr><td>Data management plan id:</td><td>"+a.dmp_id+"</td></tr><tr><td>Has data management plan:</td><td>"+a.has_dmp+"</td></tr><tr><td>Has data management plan been reviewed:</td><td>"+a.has_dmp_been_reviewed+"</td></tr></tr><td>Expected storage:</td><td>"+a.expected_storage+"</td></tr><tr><td>Lead faculty id:</td><td>"+a.lead_faculty_id+"</td></tr><tr><td>Lead faculty abbreviation:</td><td>"+a.lead_faculty_abbrev+"</td></tr><tr><td>Lead faculty name:</td><td>"+a.lead_faculty_name+"</td></tr><tr><td>Lead department id:</td><td>"+a.lead_department_id+"</td></tr><tr><td>Lead department abbrev:</td><td>"+a.lead_dept_abbrev+"</td></tr><tr><td>Lead department name:</td><td>"+a.lead_dept_name+"</td></tr></table>"}var d,e=function(c){a(c),b()};return{init:e}}();app.controller("rcukAccessComplianceTableCtrl",["$scope","$rootScope","$http","api","config",function(a,b,c,d,e){function f(a){var b={date:"project_start",sd:a.startDate,ed:a.endDate,faculty:a.faculty};d.uri.rcukAccessCompliance(b).then(function(a){RcukAccessComplianceTable.init(a)})}var g={startDate:e.startDateDefault,endDate:e.endDateDefault,faculty:e.facultyDefault};f(g),a.filterEventListener=b.$on("FilterEvent",function(a,b){f(b)}),a.$on("$destroy",function(){a.filterEventListener()})}]);var RcukAccessComplianceTable=function(){function a(a){var b=toDataTablesFormat(a),c=$("#rcukAccessComplianceTable").dataTable();c.fnDestroy(),d=$("#rcukAccessComplianceTable").DataTable({lengthMenu:[25,50,75,100],data:b.data,dom:"ClfrtipR",columns:[{data:null,className:"details-control",orderable:!1,defaultContent:""},{data:"publication_pid"},{data:"publication_date"},{data:"data_access_statement"},{data:"funder_name"},{data:"project_name"}]})}function b(){$("#rcukAccessComplianceTable tbody").on("click","td.details-control",function(){var a=$(this).closest("tr"),b=d.row(a);b.child.isShown()?(b.child.hide(),a.removeClass("shown")):(b.child(c(b.data())).show(),a.addClass("shown"))})}function c(a){return'<table cellpadding="5" cellspacing="0" border="0" style="padding-left:50px;"><tr><td>Project id:</td><td>'+a.project_id+"</td></tr><tr><td>Project name:</td><td>"+a.project_name+"</td></tr><tr><td>Publication id:</td><td>"+a.publication_id+"</td></tr><tr><td>Cris id:</td><td>"+a.cris_id+"</td></tr><td>Repo id:</td><td>"+a.repo_id+"</td></tr></tr><td>Funder project code:</td><td>"+a.funder_project_code+"</td></tr></tr><td>Lead institution id:</td><td>"+a.lead_inst_id+"</td></tr></tr><td>Lead faculty id:</td><td>"+a.lead_faculty_id+"</td></tr></tr><td>Lead department id:</td><td>"+a.lead_department_id+"</td></tr></tr><td>Publication date:</td><td>"+a.publication_date+"</td></tr><tr><td>Data access statement:</td><td>"+a.data_access_statement+"</td></tr></tr><td>Funder id:</td><td>"+a.funder_id+"</td></tr><tr><td>Funder name:</td><td>"+a.funder_name+"</td></tr></table>";
}var d,e=function(c){a(c),b()};return{init:e}}();app.controller("storageTableCtrl",["$scope","$rootScope","$http","api","config",function(a,b,c,d,e){function f(a){var b={date:"project_start",sd:a.startDate,ed:a.endDate,faculty:a.faculty};d.uri.storage(b).then(function(a){StorageTable.init(a)})}var g={startDate:e.startDateDefault,endDate:e.endDateDefault,faculty:e.facultyDefault};f(g),a.filterEventListener=b.$on("FilterEvent",function(a,b){f(b)}),a.$on("$destroy",function(){a.filterEventListener()})}]);var StorageTable=function(){function a(a){var b=toDataTablesFormat(a),c=$("#storageTable").dataTable();c.fnDestroy(),d=$("#storageTable").DataTable({lengthMenu:[25,50,75,100],data:b.data,dom:"ClfrtipR",columns:[{data:null,className:"details-control",orderable:!1,defaultContent:""},{data:"project_name"},{data:"expected_storage"},{data:"expected_storage_cost"},{data:"dataset_size"},{data:"project_start"},{data:"project_end"},{data:"dataset_pid"}]})}function b(){$("#storageTable tbody").on("click","td.details-control",function(){var a=$(this).closest("tr"),b=d.row(a);b.child.isShown()?(b.child.hide(),a.removeClass("shown")):(b.child(c(b.data())).show(),a.addClass("shown"))})}function c(a){return'<table cellpadding="5" cellspacing="0" border="0" style="padding-left:50px;"><tr><td>Project id:</td><td>'+a.project_id+"</td></tr><tr><td>Project name:</td><td>"+a.project_name+"</td></tr><tr><td>Project start date:</td><td>"+a.project_start+"</td></tr><tr><td>Project end date:</td><td>"+a.project_end+"</td></tr><tr><td>Expected storage:</td><td>"+a.expected_storage+"</td></tr><tr><td>Expected storage cost:</td><td>"+a.expected_storage_cost+"</td></tr><tr><td>Dataset pid:</td><td>"+a.dataset_pid+"</td></tr><tr><td>Dataset id:</td><td>"+a.dataset_id+"</td></tr></tr><td>Dataset size:</td><td>"+a.dataset_size+"</td></tr></table>"}var d,e=function(c){a(c),b()};return{init:e}}();