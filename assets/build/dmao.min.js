function reverseChronoChartData(a){for(var b=[],c=a.length,d=0;d<a.length;++d)--c,b[d]=[a[c].month,a[c].value];return b}function toDataTablesFormat(a){return hash={},hash.data=a,hash}var app=angular.module("dmaoApp",["ngRoute","ngTouch","ui.grid","ui.grid.cellNav","ui.grid.edit","ui.grid.rowEdit","ui.grid.selection","ui.grid.exporter","ui.grid.resizeColumns","ngCookies","ng-breadcrumbs"]);app.factory("api",function(){return ApiService}),app.factory("config",function(){return App}),app.factory("ui",function(){return UiService}),app.run(["$cookies","$location","$rootScope","api","config",function(a,b,c,d,e){var f=a.get("apiKey");f?d.apiKey=f:d.apiKey="",e.institutionId=a.get("institutionId");var g=a.get("username");g&&(c.loggedInUser=g)}]),app.config(["$routeProvider","$locationProvider",function(a,b){a.when("/landing",{templateUrl:"app/public/landing.html"}).when("/",{templateUrl:"app/public/landing.html",label:"Home"}).when("/all",{templateUrl:"app/public/landing.html"}).when("/stats",{templateUrl:"app/statistics/statistic-compilation.html"}).when("/login",{templateUrl:"app/auth/login.html"}).when("/datasets",{templateUrl:"app/tables/datasets-table.html",label:"All datasets"}).when("/datasetsRCUK",{templateUrl:"app/tables/datasets-rcuk-table.html",label:"RCUK datasets"}).when("/dmp",{templateUrl:"app/tables/dmp-table.html",label:"Data management plans produced"}).when("/nodmp",{templateUrl:"app/tables/no-dmp-table.html",label:"Projects without data management plans"}).when("/dmps",{templateUrl:"app/tables/dmp-status-table.html",label:"All data management plans"}).when("/storage",{templateUrl:"app/tables/storage-table.html",label:"Storage"}).when("/compliance",{templateUrl:"app/tables/rcuk-access-compliance-table.html",label:"RCUK access compliance"}).when("/data",{templateUrl:"app/charts/data-access-chart.html",label:"Data downloads"}).when("/metadata",{templateUrl:"app/charts/metadata-access-chart.html",label:"Metadata accesses"}).otherwise({templateUrl:"app/messages/error.html"})}]).run(["$rootScope","$location","$cookies",function(a,b,c){a.loggedInUser&&b.path(c.get("newRoute")),a.$on("$routeChangeStart",function(d,e,f){a.loggedInUser?("/"===e.$$route.originalPath&&b.path("/stats"),c.put("newRoute",e.$$route.originalPath)):"/"!==e.$$route.originalPath&&b.path("/")})}]),app.controller("loginCtrl",["$scope","$location","$rootScope","$cookies","api","config",function(a,b,c,d,e,f){function g(){angular.forEach(a.institutions,function(b){b.inst_id==a.institution&&(a.institutionName=b.name)})}function h(){a.institution="luve_u",a.username="dladmin",a.password="dladmin"}h();var i=d.get("username");i?c.loggedInUser=i:c.loggedInUser="";var j=d.get("apiKey");j?e.apiKey=j:e.apiKey="",f.institutionId=d.get("institutionId"),e.uri.o.institutions().then(function(b){a.institutions=b,g()}),a.login=function(){d.get("username")||e.authenticate(a.institution,a.username,a.password).then(function(h){h.length?(f.institutionId=a.institution,d.put("username",a.username),d.put("institutionId",a.institution),g(),d.put("institutionName",a.institutionName),e.apiKey=h[0].api_key,d.put("apiKey",h[0].api_key),a.$apply(function(){c.loggedInUser=a.username,b.path("/stats")})):alert("Aw snap! Something went wrong.")})},a.logout=function(){e.clearKey(),f.institutionId="",f.institutionName="",c.loggedInUser="";var a=d.getAll();angular.forEach(a,function(a,b){d.remove(b)}),h(),b.path("/")}}]),app.controller("dataAccessChartCtrl",["$scope","$rootScope","$http","api","config",function(a,b,c,d,e){function f(b){var c={sd:b.startDate,ed:b.endDate,faculty:b.faculty,summary_by_date:!0};d.uri.datasetAccess(c).then(function(b){a.dataAvailable=!1,b=d.filter.datasetAccess(b,"data_download"),b.length&&(a.dataAvailable=!0),a.$apply(),DataAccessLineChart(b,{width:700,height:300})})}a.dataAvailable=!1;var g={startDate:e.startDate,endDate:e.endDate,faculty:e.faculty,summary_by_date:!0};f(g),a.filterEventListener=b.$on("FilterEvent",function(a,b){f(b)}),a.$on("$destroy",function(){a.filterEventListener()})}]);var DataAccessLineChart=function(a,b){var c=!0;if(c){var d={top:20,right:20,bottom:30,left:100},e=b.width-d.left-d.right,f=b.height-d.top-d.bottom,g=d3.time.format("%Y-%m-%d").parse,h=d3.time.scale().range([0,e]),i=d3.scale.linear().range([f,0]),j=d3.svg.axis().scale(h).orient("bottom"),k=d3.svg.axis().scale(i).orient("left"),l=d3.svg.line().x(function(a){return h(a.access_date)}).y(function(a){return i(a.counter)});$("#dataAccessChart").empty();var m=d3.select("#dataAccessChart").append("svg").attr("width",b.width+d.left+d.right).attr("height",b.height+d.top+d.bottom).append("g").attr("transform","translate("+d.left+","+d.top+")");a.forEach(function(a){a.access_date=g(a.access_date),a.counter=+a.count}),h.domain(d3.extent(a,function(a){return a.access_date})),i.domain(d3.extent(a,function(a){return a.counter})),m.append("g").attr("class","x axis").attr("transform","translate(0,"+f+")").call(j),m.append("g").attr("class","y axis").call(k).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text("Downloads"),m.append("path").datum(a).attr("class","line").attr("d",l)}};app.controller("metadataAccessChartCtrl",["$scope","$rootScope","$http","api","config",function(a,b,c,d,e){function f(b){var c={sd:b.startDate,ed:b.endDate,faculty:b.faculty,summary_by_date:!0};d.uri.datasetAccess(c).then(function(b){a.dataAvailable=!1,b=d.filter.datasetAccess(b,"metadata"),b.length&&(a.dataAvailable=!0),a.$apply(),MetadataAccessLineChart(b,{width:700,height:300})})}a.dataAvailable=!1;var g={startDate:e.startDate,endDate:e.endDate,faculty:e.faculty,summary_by_date:!0};f(g),a.filterEventListener=b.$on("FilterEvent",function(a,b){f(b)}),a.$on("$destroy",function(){a.filterEventListener()})}]);var MetadataAccessLineChart=function(a,b){var c=!0;if(c){var d={top:20,right:20,bottom:30,left:100},e=b.width-d.left-d.right,f=b.height-d.top-d.bottom,g=d3.time.format("%Y-%m-%d").parse,h=d3.time.scale().range([0,e]),i=d3.scale.linear().range([f,0]),j=d3.svg.axis().scale(h).orient("bottom"),k=d3.svg.axis().scale(i).orient("left"),l=d3.svg.line().x(function(a){return h(a.access_date)}).y(function(a){return i(a.counter)});$("#metadataAccessChart").empty();var m=d3.select("#metadataAccessChart").append("svg").attr("width",b.width+d.left+d.right).attr("height",b.height+d.top+d.bottom).append("g").attr("transform","translate("+d.left+","+d.top+")");a.forEach(function(a){a.access_date=g(a.access_date),a.counter=+a.count}),h.domain(d3.extent(a,function(a){return a.access_date})),i.domain(d3.extent(a,function(a){return a.counter})),m.append("g").attr("class","x axis").attr("transform","translate(0,"+f+")").call(j),m.append("g").attr("class","y axis").call(k).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text("Accesses"),m.append("path").datum(a).attr("class","line").attr("d",l)}},DataAccessChart={init:function(a){$.ajax({url:ApiService.uri.datasetAccess(a),success:function(a){var b=ApiService.filter.datasetAccess(a,"data_download"),c=12,d=ApiService.filter.dataLastNMonths(b,c),e=reverseChronoChartData(d);if(0!=$("#data_access").size()){$("#data_access_loading").hide(),$("#data_access_content").show();var f=($.plot($("#data_access"),[{data:e,lines:{fill:.2,lineWidth:0},color:["#BAD9F5"]},{data:e,points:{show:!0,fill:!0,radius:4,fillColor:"#9ACAE6",lineWidth:2},color:"#9ACAE6",shadowSize:1},{data:e,lines:{show:!0,fill:!1,lineWidth:3},color:"#9ACAE6",shadowSize:0}],{xaxis:{tickLength:0,tickDecimals:0,mode:"categories",min:0,font:{lineHeight:14,style:"normal",variant:"small-caps",color:"#6F7B8A"}},yaxis:{ticks:5,tickDecimals:0,tickColor:"#eee",font:{lineHeight:14,style:"normal",variant:"small-caps",color:"#6F7B8A"}},grid:{hoverable:!0,clickable:!0,tickColor:"#eee",borderColor:"#eee",borderWidth:1}}),null);$("#data_access").bind("plothover",function(a,b,c){if($("#x").text(b.x.toFixed(2)),$("#y").text(b.y.toFixed(2)),c){if(f!=c.dataIndex){f=c.dataIndex,$("#tooltip").remove();c.datapoint[0].toFixed(2),c.datapoint[1].toFixed(2);showChartTooltip(c.pageX,c.pageY,c.datapoint[0],c.datapoint[1]+" downloads")}}else $("#tooltip").remove(),f=null})}}})}},MetadataAccessChart={init:function(a){$.ajax({url:ApiService.uri.datasetAccess(a),success:function(a){var b=ApiService.filter.datasetAccess(a,"metadata"),c=12,d=ApiService.filter.dataLastNMonths(b,c),e=reverseChronoChartData(d);if(0!=$("#metadata_access").size()){$("#metadata_access_loading").hide(),$("#metadata_access_content").show();var f=($.plot($("#metadata_access"),[{data:e,lines:{fill:.2,lineWidth:0},color:["#f89f9f"]},{data:e,points:{show:!0,fill:!0,radius:4,fillColor:"#f89f9f",lineWidth:2},color:"#f89f9f",shadowSize:1},{data:e,lines:{show:!0,fill:!1,lineWidth:3},color:"#f89f9f",shadowSize:0}],{xaxis:{tickLength:0,tickDecimals:0,mode:"categories",min:0,font:{lineHeight:14,style:"normal",variant:"small-caps",color:"#6F7B8A"}},yaxis:{ticks:5,tickDecimals:0,tickColor:"#eee",font:{lineHeight:14,style:"normal",variant:"small-caps",color:"#6F7B8A"}},grid:{hoverable:!0,clickable:!0,tickColor:"#eee",borderColor:"#eee",borderWidth:1}}),null);$("#metadata_access").bind("plothover",function(a,b,c){if($("#x").text(b.x.toFixed(2)),$("#y").text(b.y.toFixed(2)),c){if(f!=c.dataIndex){f=c.dataIndex,$("#tooltip").remove();c.datapoint[0].toFixed(2),c.datapoint[1].toFixed(2);showChartTooltip(c.pageX,c.pageY,c.datapoint[0],c.datapoint[1]+" downloads")}}else $("#tooltip").remove(),f=null})}}})}};app.controller("filterCtrl",["$scope","$rootScope","$interval","$timeout","$cookies","breadcrumbs","api","config",function(a,b,c,d,e,f,g,h){function i(c){b.$broadcast("FilterEvent",{msg:c,startDate:a.startDate,endDate:a.endDate,faculty:a.faculty})}function j(){var b={};g.uri.divisions().then(function(c){b[""]="All divisions";for(var d=0;d<c.length;++d)b[c[d].faculty_id]=c[d].name;a.facultyMap=b,a.$apply()}),h.facultyMap=b}a.startDate=h.startDateDefault,a.endDate=h.endDateDefault,a.faculty=h.facultyDefault,a.facultyName=h.facultyMap[h.facultyDefault],a.dummy=!1,j(),a.breadcrumbs=f,a.$watch(function(){return a.startDate},function(b,c){a.startDate=b}),a.$watch(function(){return a.endDate},function(b,c){a.endDate=b}),a.$watch(function(){return a.faculty},function(b,c){a.faculty=b,a.facultyName=h.facultyMap[b],h.faculty=b}),a.$watch(function(){return{startDate:a.startDate,endDate:a.endDate,faculty:a.faculty}},function(a,b){var c=!1;a.startDate!==b.startDate&&(c=!0),a.endDate!==b.endDate&&(c=!0),a.faculty!==b.faculty&&(c=!0),c&&i("Filter change")},!0),a.institutionName=e.get("institutionName")}]);var DMAOFilters=function(){function a(a,b){var c=angular.element($("#filterController")).scope();c.$apply(function(){c.startDate=a,c.endDate=b})}var b={},c=function(a){b=a},d=function(){$("#reportrange span").html(moment(b.startDate,"YYYYMMDD").format("MMMM D, YYYY")+" - "+moment(b.endDate,"YYYYMMDD").format("MMMM D, YYYY")),$("#reportrange").daterangepicker({format:"DD/MM/YYYY",startDate:moment(b.startDateDefault,"YYYYMMDD").format("DD/MM/YYYY"),endDate:moment(b.endDateDefault,"YYYYMMDD").format("DD/MM/YYYY"),minDate:"01/01/2000",maxDate:"31/12/9999",dateLimit:{days:1e5},showDropdowns:!0,showWeekNumbers:!0,timePicker:!1,timePickerIncrement:1,timePicker12Hour:!0,ranges:{Today:[moment(),moment()],Yesterday:[moment().subtract(1,"days"),moment().subtract(1,"days")],"Last 7 Days":[moment().subtract(6,"days"),moment()],"Last 30 Days":[moment().subtract(29,"days"),moment()],"This Month":[moment().startOf("month"),moment().endOf("month")],"Last Month":[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")]},opens:"left",drops:"down",buttonClasses:["btn","btn-sm"],applyClass:"btn-primary",cancelClass:"btn-default",separator:" to ",locale:{applyLabel:"Submit",cancelLabel:"Cancel",fromLabel:"From",toLabel:"To",customRangeLabel:"Custom",daysOfWeek:["Su","Mo","Tu","We","Th","Fr","Sa"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],firstDay:1}},function(c,d,e){$("#reportrange span").html(c.format("MMMM D, YYYY")+" - "+d.format("MMMM D, YYYY"));var f=c.format("YYYYMMDD"),g=d.format("YYYYMMDD");b.startDate=f,b.endDate=g,a(f,g)})},e=function(){b.faculty=b.facultyDefault,b.startDate=b.startDateDefault,b.endDate=b.endDateDefault,$("#reportrange").data("daterangepicker").setStartDate(moment(b.startDateDefault,"YYYYMMDD").format("DD/MM/YYYY")),$("#reportrange").data("daterangepicker").setEndDate(moment(b.endDateDefault,"YYYYMMDD").format("DD/MM/YYYY")),$("#reportrange span").html(moment(b.startDateDefault,"YYYYMMDD").format("MMMM D, YYYY")+" - "+moment(b.endDateDefault,"YYYYMMDD").format("MMMM D, YYYY"));var a=angular.element($("#filterController")).scope();a.$apply(function(){a.faculty=b.faculty,a.startDate=b.startDateDefault,a.endDate=b.endDateDefault})};return{init:c,initUserSelections:e,DateRangePicker:d}}(),App={institutionId:"",institutionName:"",institutionDataCiteSymbol:"",startDateDefault:"20000101",endDateDefault:"20350101",startDate:"20000101",endDate:"20350101",faculty:"",facultyDefault:"",facultyMap:{},departmentMap:{},updateDelay:3e4},ApiService={version:"v0.3",apiKey:"",authenticated:function(){return this.apiKey?!0:!1},prefix:function(){var a=URI({protocol:"http",hostname:"lib-dmao.lancs.ac.uk",port:"8090",path:"dmaonline"});return a+="/"+this.version,a.toString()},clearKey:function(){this.apiKey=""},authenticate:function(a,b,c){var d=URI(ApiService.prefix()+"/o/"+a+"/o_get_api_key"),e=new jsSHA("SHA-224","TEXT");e.update(c);var f=e.getHash("HEX");return d=this.uri.addParams(d,{user:b,passwd:f}),$.getJSON(d)},uri:{addParams:function(a,b){for(key in b)(b[key]||b[key]===!1)&&a.addSearch(key,b[key]);return a},datasets:function(a){var b=URI(ApiService.prefix()+"/c/"+App.institutionId+"/"+ApiService.apiKey+"/datasets");return a&&(b=this.addParams(b,a)),$.getJSON(b)},dmps:function(a){var b=URI(ApiService.prefix()+"/c/"+App.institutionId+"/"+ApiService.apiKey+"/project_dmps");return a&&(b=this.addParams(b,a)),$.getJSON(b)},dmpStatus:function(a){var b=URI(ApiService.prefix()+"/c/"+App.institutionId+"/"+ApiService.apiKey+"/dmp_status");return a&&(b=this.addParams(b,a)),$.getJSON(b)},storage:function(a){var b=URI(ApiService.prefix()+"/c/"+App.institutionId+"/"+ApiService.apiKey+"/storage");return a&&(b=this.addParams(b,a)),$.getJSON(b)},project:function(a){var b=URI(ApiService.prefix()+"/storage/"+a.project_id+"/"+App.institutionId);return b},rcukAccessCompliance:function(a){var b=URI(ApiService.prefix()+"/c/"+App.institutionId+"/"+ApiService.apiKey+"/rcuk_as");return a&&(b=this.addParams(b,a)),$.getJSON(b)},datasetAccess:function(a){var b=URI(ApiService.prefix()+"/c/"+App.institutionId+"/"+ApiService.apiKey+"/dataset_accesses");return a&&(b=this.addParams(b,a)),$.getJSON(b)},datasetAccessByDateRange:function(a){var b=this.datasetAccess(a);return $.getJSON(b)},rcukAccessCompliance:function(a){var b=URI(ApiService.prefix()+"/c/"+App.institutionId+"/"+ApiService.apiKey+"/rcuk_as");return a&&(b=this.addParams(b,a)),$.getJSON(b)},divisions:function(a){var b=URI(ApiService.prefix()+"/c/"+App.institutionId+"/"+ApiService.apiKey+"/faculties_departments");return a&&(b=this.addParams(b,a)),$.getJSON(b)},put:{dmps:function(a){var b=URI(ApiService.prefix()+"/c/"+App.institutionId+"/"+ApiService.apiKey+"/project_dmps");return a&&(b=ApiService.uri.addParams(b,a)),$.ajax({url:b,type:"PUT",success:function(a,b,c){},error:function(a,b,c){}})},storage:function(a){var b=URI(ApiService.prefix()+"/c/"+App.institutionId+"/"+ApiService.apiKey+"/storage");return a&&(b=ApiService.uri.addParams(b,a)),$.ajax({url:b,type:"PUT",success:function(a,b,c){},error:function(a,b,c){}})}},o:{institutions:function(){var a=URI(ApiService.prefix()+"/o/o_inst_list");return $.getJSON(a)}},"public":function(a){var b=URI(ApiService.prefix()+"/o/"+a);return $.getJSON(b)}},datacite:{minted:function(a){var b=URI(a);return $.getJSON(b)}},filter:{datasetAccess:function(a,b){for(var c=[],d=0;d<a.length;++d)a[d].access_type===b&&c.push(a[d]);return c},dataLastNMonths:function(a,b){for(var c=[],d=0;b>d;++d){var e=moment().subtract(d,"months").startOf("month").format("YYYY-MM-DD"),f=moment().subtract(d,"months").endOf("month").format("YYYY-MM-DD");c.push({startDate:e,endDate:f,month:moment(e).format("MMM"),value:0})}for(var d=0;d<a.length;++d)for(var g=0;b>g;++g)a[d].access_date>=c[g].startDate&&a[d].access_date<=c[g].endDate&&(c[g].value+=a[d].counter);return c},dataAggregateDateCounts:function(a){for(var b={},c=0;c<a.length;++c){var d=a[c].access_date.replace(/-/g,"");if(b[d])b[d].counter+=a[c].counter;else{var e={access_date:a[c].access_date,counter:a[c].counter};b[d]=e}}var f=[];return $.each(b,function(a,c){f.push(b[a])}),f}},template:{dr:"/dr/{institutionId}/{startDate}/{endDate}/{dateFilter}"}},UiService={spinner:function(a){var b={lines:13,length:28,width:14,radius:42,scale:1,corners:1,color:"#000",opacity:.25,rotate:0,direction:1,speed:1,trail:60,fps:20,zIndex:2e9,className:"spinner",top:"50%",left:"50%",shadow:!1,hwaccel:!1,position:"absolute"},a=document.getElementById(a);return new Spinner(b).spin(a)}};app.directive("aggregate",function(){return{restrict:"E",templateUrl:"app/statistics/aggregate-directive.html",replace:"true",scope:{value:"@",description:"@",icon:"@",colour:"@",link:"@",units:"@",currency:"@"}}}),app.controller("aggregateStatisticCtrl",["$scope","$rootScope","$http","api","config",function(a,b,c,d,e){function f(b){d.uri["public"]("o_count_institutions").then(function(b){a.data.institutions=!0;var c=b[0].count;c!==a.count_institutions&&(a.count_institutions=c.toLocaleString())}),d.uri["public"]("o_count_faculties").then(function(b){var c=b[0].count;c!==a.count_faculties&&(a.count_faculties=c.toLocaleString())}),d.uri["public"]("o_count_departments").then(function(b){var c=b[0].count;c!==a.count_departments&&(a.count_departments=c.toLocaleString())}),d.uri["public"]("o_count_dmps").then(function(b){var c=b[0].count;c!==a.count_dmps&&(a.count_dmps=c.toLocaleString())}),d.uri["public"]("o_count_publications").then(function(b){var c=b[0].count;c!==a.count_publications&&(a.count_publications=c.toLocaleString())}),d.uri["public"]("o_count_datasets").then(function(b){var c=b[0].count;c!==a.count_datasets&&(a.count_datasets=c.toLocaleString())}),d.uri["public"]("o_count_dataset_accesses").then(function(b){a.$apply(function(){a.dataset_accesses={};for(var c=0;c<b.length;++c)"data_download"===b[c].access_type&&(a.dataset_accesses.data=b[c].count.toLocaleString()),"metadata"===b[c].access_type&&(a.dataset_accesses.metadata=b[c].count.toLocaleString())})})}a.count_institutions=0,a.count_faculties=0,a.count_departments=0,a.count_dmps=0,a.count_publications=0,a.count_datasets=0,a.count_dataset_accesses=0,a.data={},a.data.institutions=!1,f({}),a.filterEventListener=b.$on("FilterEvent",function(a,b){console.log("update firing"),f(b)}),a.$on("$destroy",function(){a.filterEventListener()})}]),app.controller("dataCtrl",["$scope","$rootScope","$http","api","config",function(a,b,c,d,e){function f(b){var c={sd:b.startDate,ed:b.endDate,faculty:b.faculty,summary_totals:!0};d.uri.datasetAccess(c).then(function(b){a.$apply(function(){a.dataset_accesses={},a.dataset_accesses.data=0,a.dataset_accesses.metadata=0;for(var c=0;c<b.length;++c)"data_download"===b[c].access_type&&(a.dataset_accesses.data=b[c].count.toLocaleString()),"metadata"===b[c].access_type&&(a.dataset_accesses.metadata=b[c].count.toLocaleString())})})}f({startDate:e.startDate,endDate:e.endDate,faculty:e.faculty}),a.filterEventListener=b.$on("FilterEvent",function(a,b){f(b)}),a.$on("$destroy",function(){a.filterEventListener()})}]),app.controller("datasetsRCUKCtrl",["$scope","$rootScope","$http","api","config",function(a,b,c,d,e){function f(b){var c={date:"project_start",sd:b.startDate,ed:b.endDate,faculty:b.faculty,filter:"rcuk",count:!0};d.uri.datasets(c).then(function(b){a.$apply(function(){var c=b[0].num_datasets;c!==a.value&&(a.value=c.toLocaleString())})})}a.value=0,f({startDate:e.startDate,endDate:e.endDate,faculty:e.faculty}),a.filterEventListener=b.$on("FilterEvent",function(a,b){f(b)}),a.$on("$destroy",function(){a.filterEventListener()})}]),app.controller("datasetsCtrl",["$scope","$rootScope","$http","api","config",function(a,b,c,d,e){function f(b){var c={date:"project_start",sd:b.startDate,ed:b.endDate,faculty:b.faculty,count:!0};d.uri.datasets(c).then(function(b){a.$apply(function(){var c=(a.value,b[0].num_datasets);c!==a.value&&(a.value=c.toLocaleString())})})}a.value=0,f({startDate:e.startDate,endDate:e.endDate,faculty:e.faculty}),a.filterEventListener=b.$on("FilterEvent",function(a,b){f(b)}),a.$on("$destroy",function(){a.filterEventListener()})}]),app.controller("dmpsCreatedCtrl",["$scope","$rootScope","$http","api","config",function(a,b,c,d,e){function f(b){var c={date:"project_start",sd:b.startDate,ed:b.endDate,faculty:b.faculty,has_dmp:!0,count:!0};d.uri.dmps(c).then(function(b){a.$apply(function(){var c=b[0].num_project_dmps;c!==a.value&&(a.value=c.toLocaleString())})})}a.value=0,f({startDate:e.startDate,endDate:e.endDate,faculty:e.faculty}),a.filterEventListener=b.$on("FilterEvent",function(a,b){f(b)}),a.$on("$destroy",function(){a.filterEventListener()})}]),app.controller("dmpStatusCtrl",["$scope","$rootScope","$http","api","config",function(a,b,c,d,e){function f(b){var c={date:"project_start",sd:b.startDate,ed:b.endDate,faculty:b.faculty,count:!0};d.uri.dmpStatus(c).then(function(b){a.$apply(function(){var c=b[0].num_dmp_status;c!==a.value&&(a.value=c.toLocaleString())})})}a.value=0,f({startDate:e.startDate,endDate:e.endDate,faculty:e.faculty}),a.filterEventListener=b.$on("FilterEvent",function(a,b){f(b)}),a.$on("$destroy",function(){a.filterEventListener()})}]),app.controller("doiMintingCtrl",["$scope","$rootScope","api","config",function(a,b,c,d){function e(b){var e=b.startDate.substr(0,4)+"-"+b.startDate.substr(4,2)+"-"+b.startDate.substr(6,2),f=b.endDate.substr(0,4)+"-"+b.endDate.substr(4,2)+"-"+b.endDate.substr(6,2),g="10.17635";"birmingham"===d.institutionId&&(g="10.13140"),"york"===d.institutionId&&(g="10.15124");var h="http://search.datacite.org/api?q=*&wt=json&fq=prefix:"+g+"&rows=0&fq=minted:["+e+"T00:00:00Z/DAY%20TO%20"+f+"T23:59:59Z/DAY]";c.datacite.minted(h).then(function(b){a.$apply(function(){var c=b.response.numFound;c!==a.value&&(a.value=c.toLocaleString())})})}a.value=0,a.dois={},e({startDate:d.startDate,endDate:d.endDate}),a.filterEventListener=b.$on("FilterEvent",function(a,b){e(b)}),a.$on("$destroy",function(){a.filterEventListener()})}]),app.controller("noDmpProjectsCtrl",["$scope","$rootScope","$http","api","config",function(a,b,c,d,e){function f(b){var c={date:"project_start",sd:b.startDate,ed:b.endDate,faculty:b.faculty,has_dmp:!1,count:!0};d.uri.dmps(c).then(function(b){a.$apply(function(){var c=b[0].num_project_dmps;c!==a.value&&(a.value=c.toLocaleString())})})}f({startDate:e.startDate,endDate:e.endDate,faculty:e.faculty}),a.filterEventListener=b.$on("FilterEvent",function(a,b){f(b)}),a.$on("$destroy",function(){a.filterEventListener()})}]),app.controller("rcukAccessComplianceCtrl",["$scope","$rootScope","$http","api","config",function(a,b,c,d,e){function f(b){var c={date:"project_start",sd:b.startDate,ed:b.endDate,faculty:b.faculty};d.uri.rcukAccessCompliance(c).then(function(b){a.$apply(function(){var c=0;for(i=0;i<b.length;++i)"y"===b[i].rcuk_funder_compliant&&++c;var d=0;c&&c!==a.value&&(d=c/b.length*100,a.value=Math.round(d).toLocaleString())})})}a.value=0,f({startDate:e.startDate,endDate:e.endDate,faculty:e.faculty}),a.filterEventListener=b.$on("FilterEvent",function(a,b){f(b)}),a.$on("$destroy",function(){a.filterEventListener()})}]),app.directive("statistic",function(){return{restrict:"E",templateUrl:"app/statistics/statistic-directive.html",replace:"true",scope:{value:"@",description:"@",icon:"@",colour:"@",link:"@",units:"@",currency:"@"}}}),app.controller("storageCostCtrl",["$scope","$rootScope","$http","api","config",function(a,b,c,d,e){function f(b){var c={date:"project_start",sd:b.startDate,ed:b.endDate,faculty:b.faculty};d.uri.storage(c).then(function(b){for(var c=0,d=0;d<b.length;++d)c+=b[d].expected_storage_cost;var e=Math.round(c);a.$apply(function(){e!==a.value&&(a.value=e.toLocaleString())})})}a.value=0,f({startDate:e.startDate,endDate:e.endDate,faculty:e.faculty}),a.filterEventListener=b.$on("FilterEvent",function(a,b){f(b)}),a.$on("$destroy",function(){a.filterEventListener()})}]),app.controller("storageUnitCtrl",["$scope","$rootScope","$http","api","config",function(a,b,c,d,e){function f(b){var c={date:"project_start",sd:b.startDate,ed:b.endDate,faculty:b.faculty};d.uri.storage(c).then(function(b){for(var c=0,d=0;d<b.length;++d)c+=b[d].expected_storage;var e=Math.round(.001024*c);a.$apply(function(){e!==a.value&&(a.value=e.toLocaleString())})})}a.value=0,f({startDate:e.startDate,endDate:e.endDate,faculty:e.faculty}),a.filterEventListener=b.$on("FilterEvent",function(a,b){f(b)}),a.$on("$destroy",function(){a.filterEventListener()})}]),app.controller("datasetsRCUKTableCtrl",["$scope","$rootScope","$http","api","config",function(a,b,c,d,e){function f(a){var b={date:"project_start",sd:a.startDate,ed:a.endDate,faculty:a.faculty,filter:"rcuk"};d.uri.datasets(b).then(function(a){DatasetsRCUKTable.init(a)})}var g={startDate:e.startDate,endDate:e.endDate,faculty:e.faculty};f(g),a.filterEventListener=b.$on("FilterEvent",function(a,b){f(b)}),a.$on("$destroy",function(){a.filterEventListener()})}]);var DatasetsRCUKTable=function(){function a(a){var b=toDataTablesFormat(a),c=$("#rcukDatasetsTable").dataTable();c.fnDestroy(),d=$("#rcukDatasetsTable").DataTable({lengthMenu:[25,50,75,100],data:b.data,dom:"ClfrtipR",columns:[{data:null,className:"details-control",orderable:!1,defaultContent:""},{data:"dataset_name"},{data:"funder_name"},{data:"dataset_pid"},{data:"lead_faculty_abbrev"},{data:"lead_dept_name"},{data:"project_name"},{data:"project_start"},{data:"project_end"}]})}function b(){$("#rcukDatasetsTable tbody").on("click","td.details-control",function(){var a=$(this).closest("tr"),b=d.row(a);b.child.isShown()?(b.child.hide(),a.removeClass("shown")):(b.child(c(b.data())).show(),a.addClass("shown"))})}function c(a){return'<table cellpadding="5" cellspacing="0" border="0" style="padding-left:50px;"><tr><td>Project id:</td><td>'+a.project_id+"</td></tr><tr><td>Project name:</td><td>"+a.project_name+"</td></tr><tr><td>Project start date:</td><td>"+a.project_start+"</td></tr><tr><td>Project end date:</td><td>"+a.project_end+"</td></tr><tr><td>Funder id:</td><td>"+a.funder_id+"</td></tr><tr><td>Funder name:</td><td>"+a.funder_name+"</td></tr><tr><td>Dataset id:</td><td>"+a.dataset_id+"</td></tr><tr><td>Dataset pid:</td><td>"+a.dataset_pid+"</td></tr><tr><td>Dataset link:</td><td>"+a.dataset_link+"</td></tr><tr><td>Dataset size:</td><td>"+a.dataset_size+"</td></tr><tr><td>Dataset name:</td><td>"+a.dataset_name+"</td></tr><tr><td>Dataset notes:</td><td>"+a.dataset_notes+"</td></tr><tr><td>Storage location:</td><td>"+a.storage_location+"</td></tr><tr><td>Lead faculty id:</td><td>"+a.lead_faculty_id+"</td></tr><tr><td>Lead faculty abbreviation:</td><td>"+a.lead_faculty_abbrev+"</td></tr><tr><td>Lead faculty name:</td><td>"+a.lead_faculty_name+"</td></tr><tr><td>Lead department id:</td><td>"+a.lead_department_id+"</td></tr><tr><td>Lead department abbrev:</td><td>"+a.lead_dept_abbrev+"</td></tr><tr><td>Lead department name:</td><td>"+a.lead_dept_name+"</td></tr></table>"}var d,e=function(c){a(c),b()};return{init:e}}();app.controller("datasetsTableCtrl",["$scope","$rootScope","$http","api","config",function(a,b,c,d,e){function f(a){var b={date:"project_start",sd:a.startDate,ed:a.endDate,faculty:a.faculty};d.uri.datasets(b).then(function(a){DatasetsTable.init(a)})}var g={startDate:e.startDate,endDate:e.endDate,faculty:e.faculty};f(g),a.filterEventListener=b.$on("FilterEvent",function(a,b){f(b)}),a.$on("$destroy",function(){a.filterEventListener()})}]);var DatasetsTable=function(){function a(a){var b=toDataTablesFormat(a),c=$("#datasetsTable").dataTable();c.fnDestroy(),d=$("#datasetsTable").DataTable({lengthMenu:[25,50,75,100],data:b.data,dom:"ClfrtipR",columns:[{data:null,className:"details-control",orderable:!1,defaultContent:""},{data:"dataset_name"},{data:"funder_name"},{data:"dataset_pid"},{data:"lead_faculty_abbrev"},{data:"lead_dept_name"},{data:"project_name"},{data:"project_start"},{data:"project_end"}]})}function b(){$("#datasetsTable tbody").on("click","td.details-control",function(){var a=$(this).closest("tr"),b=d.row(a);b.child.isShown()?(b.child.hide(),a.removeClass("shown")):(b.child(c(b.data())).show(),a.addClass("shown"))})}function c(a){return'<table cellpadding="5" cellspacing="0" border="0" style="padding-left:50px;"><tr><td>Project id:</td><td>'+a.project_id+"</td></tr><tr><td>Project name:</td><td>"+a.project_name+"</td></tr><tr><td>Project start date:</td><td>"+a.project_start+"</td></tr><tr><td>Project end date:</td><td>"+a.project_end+"</td></tr><tr><td>Funder id:</td><td>"+a.funder_id+"</td></tr><tr><td>Funder name:</td><td>"+a.funder_name+"</td></tr><tr><td>Dataset id:</td><td>"+a.dataset_id+"</td></tr><tr><td>Dataset pid:</td><td>"+a.dataset_pid+"</td></tr><tr><td>Dataset link:</td><td>"+a.dataset_link+"</td></tr><tr><td>Dataset size:</td><td>"+a.dataset_size+"</td></tr><tr><td>Dataset name:</td><td>"+a.dataset_name+"</td></tr><tr><td>Dataset notes:</td><td>"+a.dataset_notes+"</td></tr><tr><td>Storage location:</td><td>"+a.storage_location+"</td></tr><tr><td>Lead faculty id:</td><td>"+a.lead_faculty_id+"</td></tr><tr><td>Lead faculty abbreviation:</td><td>"+a.lead_faculty_abbrev+"</td></tr><tr><td>Lead faculty name:</td><td>"+a.lead_faculty_name+"</td></tr><tr><td>Lead department id:</td><td>"+a.lead_department_id+"</td></tr><tr><td>Lead department abbrev:</td><td>"+a.lead_dept_abbrev+"</td></tr><tr><td>Lead department name:</td><td>"+a.lead_dept_name+"</td></tr></table>"}var d,e=function(c){a(c),b()};return{init:e}}();app.controller("dmpStatusTableCtrl",["$scope","$rootScope","$http","api","config",function(a,b,c,d,e){function f(a){var b={date:"project_start",sd:a.startDate,ed:a.endDate,faculty:a.faculty,has_dmp:!0};d.uri.dmpStatus(b).then(function(a){DmpStatusTable.init(a)})}var g={startDate:e.startDate,endDate:e.endDate,faculty:e.faculty};f(g),a.filterEventListener=b.$on("FilterEvent",function(a,b){f(b)}),a.$on("$destroy",function(){a.filterEventListener()})}]);var DmpStatusTable=function(){function a(a){var b=toDataTablesFormat(a),c=$("#dmpStatusTable").dataTable();c.fnDestroy(),d=$("#dmpStatusTable").DataTable({lengthMenu:[25,50,75,100],data:b.data,dom:"ClfrtipR",columns:[{data:null,className:"details-control",orderable:!1,defaultContent:""},{data:"project_name"},{data:"funder_id"},{data:"dmp_state"},{data:"dmp_status"},{data:"project_start"},{data:"project_end"}]})}function b(){$("#dmpStatusTable tbody").on("click","td.details-control",function(){var a=$(this).closest("tr"),b=d.row(a);b.child.isShown()?(b.child.hide(),a.removeClass("shown")):(b.child(c(b.data())).show(),a.addClass("shown"))})}function c(a){return'<table cellpadding="5" cellspacing="0" border="0" style="padding-left:50px;"><tr><td>Project id:</td><td>'+a.project_id+"</td></tr><tr><td>Project name:</td><td>"+a.project_name+"</td></tr><tr><td>Project start date:</td><td>"+a.project_start+"</td></tr><tr><td>Project end date:</td><td>"+a.project_end+"</td></tr><tr><td>Funder project code:</td><td>"+a.funder_project_code+"</td></tr><tr><td>Is awarded:</td><td>"+a.is_awarded+"</td></tr><tr><td>Institution id:</td><td>"+a.inst_id+"</td></tr><tr><td>Institution project code:</td><td>"+a.institution_project_code+"</td></tr><tr><td>Data management plan id:</td><td>"+a.dmp_id+"</td></tr><tr><td>Has data management plan been reviewed:</td><td>"+a.has_dmp_been_reviewed+"</td></tr></tr><td>Expected storage:</td><td>"+a.expected_storage+"</td></tr><tr><td>Lead faculty id:</td><td>"+a.lead_faculty_id+"</td></tr><tr><td>Lead department id:</td><td>"+a.lead_department_id+"</td></tr><tr><td>Data management plan source system id:</td><td>"+a.dmp_source_system_id+"</td></tr><tr><td>Data management plan state:</td><td>"+a.dmp_state+"</td></tr><tr><td>Data management plan status:</td><td>"+a.dmp_status+"</td></tr></table>";
}var d,e=function(c){a(c),b()};return{init:e}}();app.controller("dmpTableCtrl",["$scope","$rootScope","$http","api","config",function(a,b,c,d,e){function f(a){var b={date:"project_start",sd:a.startDate,ed:a.endDate,faculty:a.faculty,has_dmp:!0};d.uri.dmps(b).then(function(a){DmpTable.init(a)})}var g={startDate:e.startDate,endDate:e.endDate,faculty:e.faculty};f(g),a.filterEventListener=b.$on("FilterEvent",function(a,b){f(b)}),a.$on("$destroy",function(){a.filterEventListener()})}]);var DmpTable=function(){function a(a){var b=toDataTablesFormat(a),c=$("#dmpTable").dataTable();c.fnDestroy(),d=$("#dmpTable").DataTable({lengthMenu:[25,50,75,100],data:b.data,dom:"ClfrtipR",columns:[{data:null,className:"details-control",orderable:!1,defaultContent:""},{data:"project_name"},{data:"lead_faculty_abbrev"},{data:"lead_dept_name"},{data:"dmp_id"},{data:"has_dmp_been_reviewed"},{data:"project_start"},{data:"project_end"}]})}function b(){$("#dmpTable tbody").on("click","td.details-control",function(){var a=$(this).closest("tr"),b=d.row(a);b.child.isShown()?(b.child.hide(),a.removeClass("shown")):(b.child(c(b.data())).show(),a.addClass("shown"))})}function c(a){return'<table cellpadding="5" cellspacing="0" border="0" style="padding-left:50px;"><tr><td>Project id:</td><td>'+a.project_id+"</td></tr><tr><td>Project name:</td><td>"+a.project_name+"</td></tr><tr><td>Project start date:</td><td>"+a.project_start+"</td></tr><tr><td>Project end date:</td><td>"+a.project_end+"</td></tr><tr><td>Funder project code:</td><td>"+a.funder_project_code+"</td></tr><tr><td>Is awarded:</td><td>"+a.is_awarded+"</td></tr><tr><td>Institution id:</td><td>"+a.inst_id+"</td></tr><tr><td>Institution project code:</td><td>"+a.institution_project_code+"</td></tr><tr><td>Data management plan id:</td><td>"+a.dmp_id+"</td></tr><tr><td>Has data management plan:</td><td>"+a.has_dmp+"</td></tr><tr><td>Has data management plan been reviewed:</td><td>"+a.has_dmp_been_reviewed+"</td></tr></tr><td>Expected storage:</td><td>"+a.expected_storage+"</td></tr><tr><td>Lead faculty id:</td><td>"+a.lead_faculty_id+"</td></tr><tr><td>Lead faculty abbreviation:</td><td>"+a.lead_faculty_abbrev+"</td></tr><tr><td>Lead faculty name:</td><td>"+a.lead_faculty_name+"</td></tr><tr><td>Lead department id:</td><td>"+a.lead_department_id+"</td></tr><tr><td>Lead department abbrev:</td><td>"+a.lead_dept_abbrev+"</td></tr><tr><td>Lead department name:</td><td>"+a.lead_dept_name+"</td></tr></table>"}var d,e=function(c){a(c),b()};return{init:e}}();app.controller("noDmpTableCtrl",["$scope","$rootScope","$http","api","config",function(a,b,c,d,e){function f(a){var b={date:"project_start",sd:a.startDate,ed:a.endDate,faculty:a.faculty,has_dmp:!1};d.uri.dmps(b).then(function(a){NoDmpTable.init(a)})}var g={startDate:e.startDate,endDate:e.endDate,faculty:e.faculty};f(g),a.filterEventListener=b.$on("FilterEvent",function(a,b){f(b)}),a.$on("$destroy",function(){a.filterEventListener()})}]);var NoDmpTable=function(){function a(a){var b=toDataTablesFormat(a),c=$("#noDmpTable").dataTable();c.fnDestroy(),d=$("#noDmpTable").DataTable({lengthMenu:[25,50,75,100],data:b.data,dom:"ClfrtipR",columns:[{data:null,className:"details-control",orderable:!1,defaultContent:""},{data:"project_name"},{data:"lead_faculty_abbrev"},{data:"lead_dept_name"}]})}function b(){$("#noDmpTable tbody").on("click","td.details-control",function(){var a=$(this).closest("tr"),b=d.row(a);b.child.isShown()?(b.child.hide(),a.removeClass("shown")):(b.child(c(b.data())).show(),a.addClass("shown"))})}function c(a){return'<table cellpadding="5" cellspacing="0" border="0" style="padding-left:50px;"><tr><td>Project id:</td><td>'+a.project_id+"</td></tr><tr><td>Project name:</td><td>"+a.project_name+"</td></tr><tr><td>Project start date:</td><td>"+a.project_start+"</td></tr><tr><td>Project end date:</td><td>"+a.project_end+"</td></tr><tr><td>Funder project code:</td><td>"+a.funder_project_code+"</td></tr><tr><td>Is awarded:</td><td>"+a.is_awarded+"</td></tr><tr><td>Institution id:</td><td>"+a.inst_id+"</td></tr><tr><td>Institution project code:</td><td>"+a.institution_project_code+"</td></tr><tr><td>Data management plan id:</td><td>"+a.dmp_id+"</td></tr><tr><td>Has data management plan:</td><td>"+a.has_dmp+"</td></tr><tr><td>Has data management plan been reviewed:</td><td>"+a.has_dmp_been_reviewed+"</td></tr></tr><td>Expected storage:</td><td>"+a.expected_storage+"</td></tr><tr><td>Lead faculty id:</td><td>"+a.lead_faculty_id+"</td></tr><tr><td>Lead faculty abbreviation:</td><td>"+a.lead_faculty_abbrev+"</td></tr><tr><td>Lead faculty name:</td><td>"+a.lead_faculty_name+"</td></tr><tr><td>Lead department id:</td><td>"+a.lead_department_id+"</td></tr><tr><td>Lead department abbrev:</td><td>"+a.lead_dept_abbrev+"</td></tr><tr><td>Lead department name:</td><td>"+a.lead_dept_name+"</td></tr></table>"}var d,e=function(c){a(c),b()};return{init:e}}();app.controller("rcukAccessComplianceTableCtrl",["$scope","$rootScope","$http","api","config",function(a,b,c,d,e){function f(a){var b={date:"project_start",sd:a.startDate,ed:a.endDate,faculty:a.faculty};d.uri.rcukAccessCompliance(b).then(function(a){RcukAccessComplianceTable.init(a)})}var g={startDate:e.startDate,endDate:e.endDate,faculty:e.faculty};f(g),a.filterEventListener=b.$on("FilterEvent",function(a,b){f(b)}),a.$on("$destroy",function(){a.filterEventListener()})}]);var RcukAccessComplianceTable=function(){function a(a){var b=toDataTablesFormat(a),c=$("#rcukAccessComplianceTable").dataTable();c.fnDestroy(),d=$("#rcukAccessComplianceTable").DataTable({lengthMenu:[25,50,75,100],data:b.data,dom:"ClfrtipR",columns:[{data:null,className:"details-control",orderable:!1,defaultContent:""},{data:"publication_pid"},{data:"publication_date"},{data:"data_access_statement"},{data:"funder_name"},{data:"project_name"}]})}function b(){$("#rcukAccessComplianceTable tbody").on("click","td.details-control",function(){var a=$(this).closest("tr"),b=d.row(a);b.child.isShown()?(b.child.hide(),a.removeClass("shown")):(b.child(c(b.data())).show(),a.addClass("shown"))})}function c(a){return'<table cellpadding="5" cellspacing="0" border="0" style="padding-left:50px;"><tr><td>Project id:</td><td>'+a.project_id+"</td></tr><tr><td>Project name:</td><td>"+a.project_name+"</td></tr><tr><td>Publication id:</td><td>"+a.publication_id+"</td></tr><tr><td>Cris id:</td><td>"+a.cris_id+"</td></tr><td>Repo id:</td><td>"+a.repo_id+"</td></tr></tr><td>Funder project code:</td><td>"+a.funder_project_code+"</td></tr></tr><td>Lead institution id:</td><td>"+a.lead_inst_id+"</td></tr></tr><td>Lead faculty id:</td><td>"+a.lead_faculty_id+"</td></tr></tr><td>Lead department id:</td><td>"+a.lead_department_id+"</td></tr></tr><td>Publication date:</td><td>"+a.publication_date+"</td></tr><tr><td>Data access statement:</td><td>"+a.data_access_statement+"</td></tr></tr><td>Funder id:</td><td>"+a.funder_id+"</td></tr><tr><td>Funder name:</td><td>"+a.funder_name+"</td></tr></table>"}var d,e=function(c){a(c),b()};return{init:e}}();app.controller("storageTableCtrl",["$scope","$rootScope","$http","api","config",function(a,b,c,d,e){function f(a){var b={date:"project_start",sd:a.startDate,ed:a.endDate,faculty:a.faculty};d.uri.storage(b).then(function(a){StorageTable.init(a)})}var g={startDate:e.startDate,endDate:e.endDate,faculty:e.faculty};f(g),a.filterEventListener=b.$on("FilterEvent",function(a,b){f(b)}),a.$on("$destroy",function(){a.filterEventListener()})}]);var StorageTable=function(){function a(a){var b=toDataTablesFormat(a),c=$("#storageTable").dataTable();c.fnDestroy(),d=$("#storageTable").DataTable({lengthMenu:[25,50,75,100],data:b.data,dom:"ClfrtipR",columns:[{data:null,className:"details-control",orderable:!1,defaultContent:""},{data:"project_name"},{data:"expected_storage"},{data:"expected_storage_cost"},{data:"dataset_size"},{data:"project_start"},{data:"project_end"},{data:"dataset_pid"}]})}function b(){$("#storageTable tbody").on("click","td.details-control",function(){var a=$(this).closest("tr"),b=d.row(a);b.child.isShown()?(b.child.hide(),a.removeClass("shown")):(b.child(c(b.data())).show(),a.addClass("shown"))})}function c(a){return'<table cellpadding="5" cellspacing="0" border="0" style="padding-left:50px;"><tr><td>Project id:</td><td>'+a.project_id+"</td></tr><tr><td>Project name:</td><td>"+a.project_name+"</td></tr><tr><td>Project start date:</td><td>"+a.project_start+"</td></tr><tr><td>Project end date:</td><td>"+a.project_end+"</td></tr><tr><td>Expected storage:</td><td>"+a.expected_storage+"</td></tr><tr><td>Expected storage cost:</td><td>"+a.expected_storage_cost+"</td></tr><tr><td>Dataset pid:</td><td>"+a.dataset_pid+"</td></tr><tr><td>Dataset id:</td><td>"+a.dataset_id+"</td></tr></tr><td>Dataset size:</td><td>"+a.dataset_size+"</td></tr></table>"}var d,e=function(c){a(c),b()};return{init:e}}();app.controller("uiGridDatasetsRcukTableCtrl",["$scope","$rootScope","$http","api","ui","config","$q","$interval",function(a,b,c,d,e,f,g,h){function i(b){var c={date:"project_start",filter:"rcuk",sd:b.startDate,ed:b.endDate,faculty:b.faculty};d.uri.datasets(c).then(function(b){a.dataLoaded=!0,a.gridOptions.data=b,a.$apply()})}a.dataLoaded=!1;var j={startDate:f.startDate,endDate:f.endDate,faculty:f.faculty};a.gridOptions={},a.gridOptions={rowEditWaitInterval:1,enableGridMenu:!0,rowHeight:35,enableColumnResizing:!0,enableFiltering:!0,enableSelectAll:!0,exporterCsvFilename:"datasetsRcuk.csv",exporterPdfDefaultStyle:{fontSize:8},exporterPdfTableStyle:{margin:[0,15,0,5]},exporterPdfTableHeaderStyle:{fontSize:10,bold:!0,italics:!0,color:"black"},exporterPdfHeader:{text:"RCUK datasets",style:"headerStyle"},exporterPdfFooter:function(a,b){return{text:a.toString()+" of "+b.toString(),style:"footerStyle"}},exporterPdfCustomFormatter:function(a){return a.styles.headerStyle={fontSize:22,bold:!0,margin:[340,0,20,0]},a.styles.footerStyle={fontSize:10,bold:!0,margin:[400,0,20,0]},a},exporterPdfOrientation:"landscape",exporterPdfPageSize:"A4",exporterPdfMaxGridWidth:700,exporterCsvLinkElement:angular.element(document.querySelectorAll(".custom-csv-link-location"))},a.gridOptions.columnDefs=[{name:"dataset_name",displayName:"Dataset",width:250,enableCellEdit:!1},{name:"funder_name",displayName:"Funder",width:250,enableCellEdit:!1},{name:"dataset_pid",displayName:"Dataset PID",width:80,enableCellEdit:!1,enableFiltering:!1},{name:"lead_faculty_abbrev",displayName:"Lead Faculty",width:110,enableCellEdit:!1,enableFiltering:!1},{name:"lead_dept_name",displayName:"Lead Dept",width:140,enableCellEdit:!1,enableFiltering:!1},{name:"project_name",displayName:"Project",width:250,enableCellEdit:!1},{name:"project_start",displayName:"Project Start",width:110,enableCellEdit:!1,enableFiltering:!1},{name:"project_end",displayName:"Project End",width:110,enableCellEdit:!1,enableFiltering:!1}],i(j),a.gridOptions.onRegisterApi=function(b){a.gridApi=b},a.currentFocused="",a.getCurrentFocus=function(){var b=a.gridApi.cellNav.getFocusedCell();null!==b&&(a.currentFocused="Row Id:"+b.row.entity.id+" col:"+b.col.colDef.name)},a.getCurrentSelection=function(){for(var b=[],c=a.gridApi.cellNav.getCurrentSelection(),d=0;d<c.length;d++)b.push(c[d].row.entity[c[d].col.name]);a.printSelection=b.toString()},a.scrollTo=function(b,c){a.gridApi.core.scrollTo(a.gridOptions.data[b],a.gridOptions.columnDefs[c])},a.scrollToFocus=function(b,c){a.gridApi.cellNav.scrollToFocus(a.gridOptions.data[b],a.gridOptions.columnDefs[c])},a.filterEventListener=b.$on("FilterEvent",function(a,b){i(b)}),a.$on("$destroy",function(){a.filterEventListener()})}]),app.controller("uiGridDatasetsTableCtrl",["$scope","$rootScope","$http","api","ui","config","$q","$interval",function(a,b,c,d,e,f,g,h){function i(b){var c={date:"project_start",sd:b.startDate,ed:b.endDate,faculty:b.faculty};d.uri.datasets(c).then(function(b){a.dataLoaded=!0,a.gridOptions.data=b,a.$apply()})}a.dataLoaded=!1;var j={startDate:f.startDate,endDate:f.endDate,faculty:f.faculty};a.gridOptions={},a.gridOptions={rowEditWaitInterval:1,enableGridMenu:!0,rowHeight:35,enableColumnResizing:!0,enableFiltering:!0,enableSelectAll:!0,exporterCsvFilename:"datasets.csv",exporterPdfDefaultStyle:{fontSize:8},exporterPdfTableStyle:{margin:[0,15,0,5]},exporterPdfTableHeaderStyle:{fontSize:10,bold:!0,italics:!0,color:"black"},exporterPdfHeader:{text:"All datasets",style:"headerStyle"},exporterPdfFooter:function(a,b){return{text:a.toString()+" of "+b.toString(),style:"footerStyle"}},exporterPdfCustomFormatter:function(a){return a.styles.headerStyle={fontSize:22,bold:!0,margin:[340,0,20,0]},a.styles.footerStyle={fontSize:10,bold:!0,margin:[400,0,20,0]},a},exporterPdfOrientation:"landscape",exporterPdfPageSize:"A4",exporterPdfMaxGridWidth:700,exporterCsvLinkElement:angular.element(document.querySelectorAll(".custom-csv-link-location"))},a.gridOptions.columnDefs=[{name:"dataset_name",displayName:"Dataset",width:250,enableCellEdit:!1},{name:"funder_name",displayName:"Funder",width:250,enableCellEdit:!1},{name:"dataset_pid",displayName:"Dataset PID",width:80,enableCellEdit:!1,enableFiltering:!1},{name:"lead_faculty_abbrev",displayName:"Lead Faculty",width:110,enableCellEdit:!1,enableFiltering:!1},{name:"lead_dept_name",displayName:"Lead Dept",width:140,enableCellEdit:!1,enableFiltering:!1},{name:"project_name",displayName:"Project",width:250,enableCellEdit:!1},{name:"project_start",displayName:"Project Start",width:110,enableCellEdit:!1,enableFiltering:!1},{name:"project_end",displayName:"Project End",width:110,enableCellEdit:!1,enableFiltering:!1}],i(j),a.gridOptions.onRegisterApi=function(b){a.gridApi=b},a.currentFocused="",a.getCurrentFocus=function(){var b=a.gridApi.cellNav.getFocusedCell();null!==b&&(a.currentFocused="Row Id:"+b.row.entity.id+" col:"+b.col.colDef.name)},a.getCurrentSelection=function(){for(var b=[],c=a.gridApi.cellNav.getCurrentSelection(),d=0;d<c.length;d++)b.push(c[d].row.entity[c[d].col.name]);a.printSelection=b.toString()},a.scrollTo=function(b,c){a.gridApi.core.scrollTo(a.gridOptions.data[b],a.gridOptions.columnDefs[c])},a.scrollToFocus=function(b,c){a.gridApi.cellNav.scrollToFocus(a.gridOptions.data[b],a.gridOptions.columnDefs[c])},a.filterEventListener=b.$on("FilterEvent",function(a,b){i(b)}),a.$on("$destroy",function(){a.filterEventListener()})}]),app.controller("uiGridDmpStatusTableCtrl",["$scope","$rootScope","$http","api","ui","config","$q","$interval",function(a,b,c,d,e,f,g,h){function i(b){var c={date:"project_start",sd:b.startDate,ed:b.endDate,faculty:b.faculty};d.uri.dmpStatus(c).then(function(b){a.dataLoaded=!0,a.gridOptions.data=b,a.$apply()})}a.dataLoaded=!1;var j={startDate:f.startDate,endDate:f.endDate,faculty:f.faculty};a.gridOptions={},a.gridOptions={rowEditWaitInterval:1,enableGridMenu:!0,rowHeight:35,enableColumnResizing:!0,enableFiltering:!0,enableSelectAll:!0,exporterCsvFilename:"dmpStatus.csv",exporterPdfDefaultStyle:{fontSize:8},exporterPdfTableStyle:{margin:[0,15,0,5]},exporterPdfTableHeaderStyle:{fontSize:10,bold:!0,italics:!0,color:"black"},exporterPdfHeader:{text:"All data management plans",style:"headerStyle"},exporterPdfFooter:function(a,b){return{text:a.toString()+" of "+b.toString(),style:"footerStyle"}},exporterPdfCustomFormatter:function(a){return a.styles.headerStyle={fontSize:22,bold:!0,margin:[340,0,20,0]},a.styles.footerStyle={fontSize:10,bold:!0,margin:[400,0,20,0]},a},exporterPdfOrientation:"landscape",exporterPdfPageSize:"A4",exporterPdfMaxGridWidth:700,exporterCsvLinkElement:angular.element(document.querySelectorAll(".custom-csv-link-location"))},a.gridOptions.columnDefs=[{name:"project_name",displayName:"Project",width:250,enableCellEdit:!1},{name:"funder_name",displayName:"Funder",width:150,enableCellEdit:!1},{name:"dmp_state",displayName:"DMP State",width:110,enableCellEdit:!1,enableFiltering:!1},{name:"dmp_status",displayName:"DMP Status",width:140,enableCellEdit:!1,enableFiltering:!1},{name:"project_start",displayName:"Project Start",width:110,enableCellEdit:!1,enableFiltering:!1},{name:"project_end",displayName:"Project End",width:110,enableCellEdit:!1,enableFiltering:!1}],i(j),d.uri.dmps({modifiable:!0}).success(function(b){a.modifiable_column_constraints={};for(var c in b)a.modifiable_column_constraints[b[c].c_name]=b[c].c_vals}),a.gridOptions.onRegisterApi=function(b){a.gridApi=b,b.rowEdit.on.saveRow(a,a.saveRow)},a.saveRow=function(b){var c=e.spinner("loader"),f={project_id:b.project_id,has_dmp_been_reviewed:b.has_dmp_been_reviewed},g=d.uri.put.dmps(f);a.gridApi.rowEdit.setSavePromise(b,g),g.success(function(b){a.gridApi.rowEdit.flushDirtyRows(a.gridApi.grid),c.stop()}),g.error(function(a){alert("Error whilst saving data to server"),c.stop()}),a.savingData=!1},a.currentFocused="",a.getCurrentFocus=function(){var b=a.gridApi.cellNav.getFocusedCell();null!==b&&(a.currentFocused="Row Id:"+b.row.entity.id+" col:"+b.col.colDef.name)},a.getCurrentSelection=function(){for(var b=[],c=a.gridApi.cellNav.getCurrentSelection(),d=0;d<c.length;d++)b.push(c[d].row.entity[c[d].col.name]);a.printSelection=b.toString()},a.scrollTo=function(b,c){a.gridApi.core.scrollTo(a.gridOptions.data[b],a.gridOptions.columnDefs[c])},a.scrollToFocus=function(b,c){a.gridApi.cellNav.scrollToFocus(a.gridOptions.data[b],a.gridOptions.columnDefs[c])},a.filterEventListener=b.$on("FilterEvent",function(a,b){i(b)}),a.$on("$destroy",function(){a.filterEventListener()})}]),app.controller("uiGridDmpTableCtrl",["$scope","$rootScope","$http","api","ui","config","$q","$interval",function(a,b,c,d,e,f,g,h){function i(b){var c={date:"project_start",sd:b.startDate,ed:b.endDate,has_dmp:!0,faculty:b.faculty};d.uri.dmps(c).then(function(b){a.dataLoaded=!0,a.gridOptions.data=b,a.$apply()})}a.dataLoaded=!1;var j={startDate:f.startDate,endDate:f.endDate,faculty:f.faculty};a.gridOptions={},a.gridOptions={rowEditWaitInterval:1,enableGridMenu:!0,rowHeight:35,enableColumnResizing:!0,enableFiltering:!0,enableSelectAll:!0,exporterCsvFilename:"dmp.csv",exporterPdfDefaultStyle:{fontSize:8},exporterPdfTableStyle:{margin:[0,15,0,5]},exporterPdfTableHeaderStyle:{fontSize:10,bold:!0,italics:!0,color:"black"},exporterPdfHeader:{text:"Data management plans produced",style:"headerStyle"},exporterPdfFooter:function(a,b){return{text:a.toString()+" of "+b.toString(),style:"footerStyle"}},exporterPdfCustomFormatter:function(a){return a.styles.headerStyle={fontSize:22,bold:!0,margin:[340,0,20,0]},a.styles.footerStyle={fontSize:10,bold:!0,margin:[400,0,20,0]},a},exporterPdfOrientation:"landscape",exporterPdfPageSize:"A4",exporterPdfMaxGridWidth:700,exporterCsvLinkElement:angular.element(document.querySelectorAll(".custom-csv-link-location"))},a.gridOptions.columnDefs=[{name:"project_name",displayName:"Project",width:250,enableCellEdit:!1},{name:"lead_faculty_abbrev",displayName:"Lead Faculty",width:110,enableCellEdit:!1,enableFiltering:!1},{name:"lead_dept_name",displayName:"Lead Dept",width:140,enableCellEdit:!1,enableFiltering:!1},{name:"dmp_id",displayName:"DMP ID",width:80,enableCellEdit:!1,enableFiltering:!1},{name:"has_dmp_been_reviewed",displayName:"DMP Reviewed",width:130,headerCellClass:"columnEditableHeaderCell",enableCellEdit:!0,enableFiltering:!1,editDropdownIdLabel:"value",editDropdownValueLabel:"value",editableCellTemplate:"ui-grid/dropdownEditor",editDropdownOptionsArray:[{id:1,value:"yes"},{id:2,value:"no"},{id:3,value:"unknown"}]},{name:"project_start",displayName:"Project Start",width:110,enableCellEdit:!1,enableFiltering:!1},{name:"project_end",displayName:"Project End",width:110,enableCellEdit:!1,enableFiltering:!1}],i(j),d.uri.dmps({modifiable:!0}).success(function(b){a.modifiable_column_constraints={};for(var c in b)a.modifiable_column_constraints[b[c].c_name]=b[c].c_vals}),a.gridOptions.onRegisterApi=function(b){a.gridApi=b,b.rowEdit.on.saveRow(a,a.saveRow)},a.saveRow=function(b){var c=e.spinner("loader"),f={project_id:b.project_id,has_dmp_been_reviewed:b.has_dmp_been_reviewed},g=d.uri.put.dmps(f);a.gridApi.rowEdit.setSavePromise(b,g),g.success(function(b){a.gridApi.rowEdit.flushDirtyRows(a.gridApi.grid),c.stop()}),g.error(function(a){alert("Error whilst saving data to server"),c.stop()}),a.savingData=!1},a.currentFocused="",a.getCurrentFocus=function(){var b=a.gridApi.cellNav.getFocusedCell();null!==b&&(a.currentFocused="Row Id:"+b.row.entity.id+" col:"+b.col.colDef.name)},a.getCurrentSelection=function(){for(var b=[],c=a.gridApi.cellNav.getCurrentSelection(),d=0;d<c.length;d++)b.push(c[d].row.entity[c[d].col.name]);a.printSelection=b.toString()},a.scrollTo=function(b,c){a.gridApi.core.scrollTo(a.gridOptions.data[b],a.gridOptions.columnDefs[c])},a.scrollToFocus=function(b,c){a.gridApi.cellNav.scrollToFocus(a.gridOptions.data[b],a.gridOptions.columnDefs[c])},a.filterEventListener=b.$on("FilterEvent",function(a,b){i(b)}),a.$on("$destroy",function(){a.filterEventListener()})}]),app.controller("uiGridNoDmpTableCtrl",["$scope","$rootScope","$http","api","ui","config","$q","$interval",function(a,b,c,d,e,f,g,h){function i(b){var c={date:"project_start",sd:b.startDate,ed:b.endDate,has_dmp:!1,faculty:b.faculty};d.uri.dmps(c).then(function(b){a.dataLoaded=!0,a.gridOptions.data=b,a.$apply()})}a.dataLoaded=!1;var j={startDate:f.startDate,endDate:f.endDate,faculty:f.faculty};a.gridOptions={},a.gridOptions={rowEditWaitInterval:1,enableGridMenu:!0,rowHeight:35,enableColumnResizing:!0,enableFiltering:!0,enableSelectAll:!0,exporterCsvFilename:"noDmp.csv",exporterPdfDefaultStyle:{fontSize:8},exporterPdfTableStyle:{margin:[0,15,0,5]},exporterPdfTableHeaderStyle:{fontSize:10,bold:!0,italics:!0,color:"black"},exporterPdfHeader:{text:"Projects without data management plans",style:"headerStyle"},exporterPdfFooter:function(a,b){return{text:a.toString()+" of "+b.toString(),style:"footerStyle"}},exporterPdfCustomFormatter:function(a){return a.styles.headerStyle={fontSize:22,bold:!0,margin:[340,0,20,0]},a.styles.footerStyle={fontSize:10,bold:!0,margin:[400,0,20,0]},a},exporterPdfOrientation:"landscape",exporterPdfPageSize:"A4",exporterPdfMaxGridWidth:700,exporterCsvLinkElement:angular.element(document.querySelectorAll(".custom-csv-link-location"))},a.gridOptions.columnDefs=[{name:"project_name",displayName:"Project",width:250,enableCellEdit:!1},{name:"lead_faculty_abbrev",displayName:"Lead Faculty",width:110,enableCellEdit:!1,enableFiltering:!1},{name:"lead_dept_name",displayName:"Lead Dept",width:250,enableCellEdit:!1,enableFiltering:!1}],i(j),d.uri.dmps({modifiable:!0}).success(function(b){a.modifiable_column_constraints={};for(var c in b)a.modifiable_column_constraints[b[c].c_name]=b[c].c_vals}),a.gridOptions.onRegisterApi=function(b){a.gridApi=b},a.currentFocused="",a.getCurrentFocus=function(){var b=a.gridApi.cellNav.getFocusedCell();null!==b&&(a.currentFocused="Row Id:"+b.row.entity.id+" col:"+b.col.colDef.name)},a.getCurrentSelection=function(){for(var b=[],c=a.gridApi.cellNav.getCurrentSelection(),d=0;d<c.length;d++)b.push(c[d].row.entity[c[d].col.name]);a.printSelection=b.toString()},a.scrollTo=function(b,c){a.gridApi.core.scrollTo(a.gridOptions.data[b],a.gridOptions.columnDefs[c])},a.scrollToFocus=function(b,c){a.gridApi.cellNav.scrollToFocus(a.gridOptions.data[b],a.gridOptions.columnDefs[c])},a.filterEventListener=b.$on("FilterEvent",function(a,b){i(b)}),a.$on("$destroy",function(){a.filterEventListener()})}]),app.controller("uiGridRcukAccessComplianceTableCtrl",["$scope","$rootScope","$http","api","ui","config","$q","$interval",function(a,b,c,d,e,f,g,h){function i(b){var c={date:"project_start",sd:b.startDate,ed:b.endDate,faculty:b.faculty};d.uri.rcukAccessCompliance(c).then(function(b){a.dataLoaded=!0,a.gridOptions.data=b,a.$apply()})}a.dataLoaded=!1;var j={startDate:f.startDate,endDate:f.endDate,faculty:f.faculty};a.gridOptions={},a.gridOptions={rowEditWaitInterval:1,enableGridMenu:!0,rowHeight:35,enableColumnResizing:!0,enableFiltering:!0,enableSelectAll:!0,exporterCsvFilename:"rcukAccessCompliance.csv",exporterPdfDefaultStyle:{fontSize:8},exporterPdfTableStyle:{margin:[0,15,0,5]},exporterPdfTableHeaderStyle:{fontSize:10,bold:!0,italics:!0,color:"black"},exporterPdfHeader:{text:"RCUK access compliance",style:"headerStyle"},exporterPdfFooter:function(a,b){return{text:a.toString()+" of "+b.toString(),style:"footerStyle"}},exporterPdfCustomFormatter:function(a){return a.styles.headerStyle={fontSize:22,bold:!0,margin:[340,0,20,0]},a.styles.footerStyle={fontSize:10,bold:!0,margin:[400,0,20,0]},a},exporterPdfOrientation:"landscape",exporterPdfPageSize:"A4",exporterPdfMaxGridWidth:700,exporterCsvLinkElement:angular.element(document.querySelectorAll(".custom-csv-link-location"))},a.gridOptions.columnDefs=[{name:"publication_pid",displayName:"Publication",width:150,enableCellEdit:!1,enableFiltering:!1},{name:"publication_date",displayName:"Publication Date",width:140,enableCellEdit:!1,enableFiltering:!1},{name:"data_access_statement",displayName:"Data access statement",width:180,enableCellEdit:!1,enableFiltering:!1},{name:"rcuk_funder_compliant",displayName:"RCUK funder compliant",width:190,enableCellEdit:!1,enableFiltering:!1},{name:"funder_name",displayName:"Funder name",width:110,enableCellEdit:!1,enableFiltering:!1},{name:"project_name",displayName:"Project",width:250,enableCellEdit:!1}],i(j),d.uri.dmps({modifiable:!0}).success(function(b){a.modifiable_column_constraints={};for(var c in b)a.modifiable_column_constraints[b[c].c_name]=b[c].c_vals}),a.gridOptions.onRegisterApi=function(b){a.gridApi=b},a.currentFocused="",a.getCurrentFocus=function(){var b=a.gridApi.cellNav.getFocusedCell();null!==b&&(a.currentFocused="Row Id:"+b.row.entity.id+" col:"+b.col.colDef.name)},a.getCurrentSelection=function(){for(var b=[],c=a.gridApi.cellNav.getCurrentSelection(),d=0;d<c.length;d++)b.push(c[d].row.entity[c[d].col.name]);a.printSelection=b.toString()},a.scrollTo=function(b,c){a.gridApi.core.scrollTo(a.gridOptions.data[b],a.gridOptions.columnDefs[c])},a.scrollToFocus=function(b,c){a.gridApi.cellNav.scrollToFocus(a.gridOptions.data[b],a.gridOptions.columnDefs[c])},a.filterEventListener=b.$on("FilterEvent",function(a,b){i(b)}),a.$on("$destroy",function(){a.filterEventListener()})}]),app.controller("uiGridStorageTableCtrl",["$scope","$rootScope","api","ui","config","$q","$interval",function(a,b,c,d,e,f,g){function h(b){var d={date:"project_start",sd:b.startDate,ed:b.endDate,faculty:b.faculty};c.uri.storage(d).then(function(b){a.gridOptions.data=b,a.$apply()})}var i={startDate:e.startDate,endDate:e.endDate,faculty:e.faculty};a.gridOptions={},a.modifications={},a.gridOptions={rowEditWaitInterval:1,enableGridMenu:!0,rowHeight:35,enableColumnResizing:!0,enableFiltering:!0,enableSelectAll:!0,exporterCsvFilename:"storage.csv",exporterPdfDefaultStyle:{fontSize:8},exporterPdfTableStyle:{margin:[0,15,0,5]},exporterPdfTableHeaderStyle:{fontSize:10,bold:!0,italics:!0,color:"black"},exporterPdfHeader:{text:"Storage",style:"headerStyle"},exporterPdfFooter:function(a,b){return{text:a.toString()+" of "+b.toString(),style:"footerStyle"}},exporterPdfCustomFormatter:function(a){return a.styles.headerStyle={fontSize:22,bold:!0,margin:[340,0,20,0]},a.styles.footerStyle={fontSize:10,bold:!0,margin:[400,0,20,0]},a},exporterPdfOrientation:"landscape",exporterPdfPageSize:"A4",exporterPdfMaxGridWidth:700,exporterCsvLinkElement:angular.element(document.querySelectorAll(".custom-csv-link-location"))},a.gridOptions.columnDefs=[{name:"project_name",displayName:"Project",width:250,sort:{direction:"asc"},enableCellEdit:!1},{name:"inst_storage_platform_id",displayName:"Platform",sort:{direction:"asc"},width:100,enableCellEdit:!1},{name:"expected_storage",displayName:"Expected (GB)",width:110,type:"number",headerCellClass:"columnEditableHeaderCell",cellClass:"columnEditableCellContents",enableCellEdit:!0,enableFiltering:!1},{name:"expected_storage_cost",displayName:"Expected Cost",width:120,cellFilter:"number: 2",enableCellEdit:!1,enableFiltering:!1},{name:"dataset_size",displayName:"Dataset Size (GB)",width:140,enableCellEdit:!1,enableFiltering:!1},{name:"project_start",displayName:"Project Start",width:110,enableCellEdit:!1,enableFiltering:!1},{name:"project_end",displayName:"Project End",width:110,enableCellEdit:!1,enableFiltering:!1},{name:"dataset_pid",displayName:"Dataset PID",width:300,enableCellEdit:!1,enableFiltering:!1}],h(i),c.uri.storage({modifiable:!0}).success(function(b){a.modifiable_column_constraints={};for(var c in b)a.modifiable_column_constraints[b[c].c_name]=b[c].c_vals}),a.gridOptions.onRegisterApi=function(b){a.gridApi=b,b.rowEdit.on.saveRow(a,a.saveRow),b.edit.on.afterCellEdit(a,function(b,c,d,e){a.modifications[c.name]={old:e,"new":d}})},a.saveRow=function(b){var e=d.spinner("loader"),f="";f=a.modifications.inst_storage_platform_id?a.modifications.inst_storage_platform_id.old:b.inst_storage_platform_id;var g={old_inst_storage_platform_id:f,inst_storage_platform_id:b.inst_storage_platform_id,expected_storage:b.expected_storage.toString(),project_id:b.project_id},h=c.uri.put.storage(g);a.gridApi.rowEdit.setSavePromise(b,h),h.success(function(c){a.modifications={},b.expected_storage_cost=c[1][0].expected_storage_cost,a.gridApi.rowEdit.flushDirtyRows(a.gridApi.grid),e.stop()}),h.error(function(a){alert("Error whilst saving data to server"),e.stop()})},a.currentFocused="",a.getCurrentFocus=function(){var b=a.gridApi.cellNav.getFocusedCell();null!==b&&(a.currentFocused="Row Id:"+b.row.entity.id+" col:"+b.col.colDef.name)},a.getCurrentSelection=function(){for(var b=[],c=a.gridApi.cellNav.getCurrentSelection(),d=0;d<c.length;d++)b.push(c[d].row.entity[c[d].col.name]);a.printSelection=b.toString()},a.scrollTo=function(b,c){a.gridApi.core.scrollTo(a.gridOptions.data[b],a.gridOptions.columnDefs[c])},a.scrollToFocus=function(b,c){a.gridApi.cellNav.scrollToFocus(a.gridOptions.data[b],a.gridOptions.columnDefs[c])},a.filterEventListener=b.$on("FilterEvent",function(a,b){h(b)}),a.$on("$destroy",function(){a.filterEventListener()})}]);